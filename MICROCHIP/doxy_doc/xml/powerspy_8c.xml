<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<doxygen xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="compound.xsd" version="1.8.11">
  <compounddef id="powerspy_8c" kind="file" language="C++">
    <compoundname>powerspy.c</compoundname>
    <includes local="no">xc.h</includes>
    <includes local="no">limits.h</includes>
    <includes refid="types_8h" local="yes">types.h</includes>
    <includes refid="message_8h" local="yes">message.h</includes>
    <includes refid="powerspy_8h" local="yes">powerspy.h</includes>
    <incdepgraph>
      <node id="11">
        <label>xc.h</label>
      </node>
      <node id="13">
        <label>types.h</label>
        <link refid="types_8h"/>
      </node>
      <node id="10">
        <label>powerspy.X/powerspy.c</label>
        <link refid="powerspy.c"/>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="12" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
        <childnode refid="14" relation="include">
        </childnode>
        <childnode refid="15" relation="include">
        </childnode>
      </node>
      <node id="15">
        <label>powerspy.h</label>
        <link refid="powerspy_8h"/>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
      </node>
      <node id="14">
        <label>message.h</label>
        <link refid="message_8h"/>
        <childnode refid="11" relation="include">
        </childnode>
        <childnode refid="13" relation="include">
        </childnode>
      </node>
      <node id="12">
        <label>limits.h</label>
      </node>
    </incdepgraph>
      <sectiondef kind="var">
      <memberdef kind="variable" id="powerspy_8c_1af2d77e425ddefb2c450823a3d6f84c85" prot="public" static="no" mutable="no">
        <type>const uint8_t</type>
        <definition>const uint8_t get_shift_byte[10]</definition>
        <argsstring>[10]</argsstring>
        <name>get_shift_byte</name>
        <initializer>= {NR0, NR1, NR2, NR3, NR4, NR5, NR6, NR7, NR8, NR9}</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="33" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="33" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="powerspy_8c_1a26d6dd4e11d19fb5532884192f76fe6b" prot="public" static="no" mutable="no">
        <type>uint16_t</type>
        <definition>uint16_t volt_time</definition>
        <argsstring></argsstring>
        <name>volt_time</name>
        <initializer>= 0</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="37" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="37" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="powerspy_8c_1a961ddcfe29f60d8ffb4bf2fe46576acd" prot="public" static="no" mutable="no">
        <type>uint16_t</type>
        <definition>uint16_t curr_time</definition>
        <argsstring></argsstring>
        <name>curr_time</name>
        <initializer>= 0</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="38" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="38" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="powerspy_8c_1aa043779ff6ca752cdff814fbb767aff7" prot="public" static="no" mutable="no">
        <type>uint8_t</type>
        <definition>volatile uint8_t flag</definition>
        <argsstring></argsstring>
        <name>flag</name>
        <initializer>= 0</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="45" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="45" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="powerspy_8c_1a76bb5897bb1c4e26f3f09d265e806d46" prot="public" static="no" mutable="no">
        <type>int24_t</type>
        <definition>int24_t i_u_offs</definition>
        <argsstring></argsstring>
        <name>i_u_offs</name>
        <initializer>= -12500</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="48" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="48" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="powerspy_8c_1a3086cfffceff5de842407d96e9dfebd0" prot="public" static="no" mutable="no">
        <type>uint8_t</type>
        <definition>uint8_t i_u_diode_offs</definition>
        <argsstring></argsstring>
        <name>i_u_diode_offs</name>
        <initializer>= 7</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="49" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="49" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="powerspy_8c_1a89443fdfb1acd74a1fedf4e400757851" prot="public" static="no" mutable="no">
        <type>uint16_t</type>
        <definition>uint16_t led_rest</definition>
        <argsstring></argsstring>
        <name>led_rest</name>
        <initializer>= 0</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="51" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="51" bodyend="-1"/>
      </memberdef>
      <memberdef kind="variable" id="powerspy_8c_1afe822df88f0a1fdfd0b8f9641745ad8b" prot="public" static="no" mutable="no">
        <type>uint8_t</type>
        <definition>volatile uint8_t mode</definition>
        <argsstring></argsstring>
        <name>mode</name>
        <initializer>= DMODE_NONE</initializer>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="53" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="53" bodyend="-1"/>
      </memberdef>
      </sectiondef>
      <sectiondef kind="func">
      <memberdef kind="function" id="powerspy_8c_1a951d8b2b8bc8596a9ccb6db62ef125d8" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>__EEPROM_DATA</definition>
        <argsstring>(0, 2, 3, 5, 6, 8, 9, 11)</argsstring>
        <name>__EEPROM_DATA</name>
        <param>
          <type>0</type>
        </param>
        <param>
          <type>2</type>
        </param>
        <param>
          <type>3</type>
        </param>
        <param>
          <type>5</type>
        </param>
        <param>
          <type>6</type>
        </param>
        <param>
          <type>8</type>
        </param>
        <param>
          <type>9</type>
        </param>
        <param>
          <type>11</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="19" column="1"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a279116ee624abe7f5a2701de9bbd6a64" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>__EEPROM_DATA</definition>
        <argsstring>(13, 14, 16, 17, 19, 20, 22, 23)</argsstring>
        <name>__EEPROM_DATA</name>
        <param>
          <type>13</type>
        </param>
        <param>
          <type>14</type>
        </param>
        <param>
          <type>16</type>
        </param>
        <param>
          <type>17</type>
        </param>
        <param>
          <type>19</type>
        </param>
        <param>
          <type>20</type>
        </param>
        <param>
          <type>22</type>
        </param>
        <param>
          <type>23</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="20" column="1"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a345eaed652f9ef24f0cfee26825f3758" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>__EEPROM_DATA</definition>
        <argsstring>(25, 26, 28, 29, 31, 32, 34, 35)</argsstring>
        <name>__EEPROM_DATA</name>
        <param>
          <type>25</type>
        </param>
        <param>
          <type>26</type>
        </param>
        <param>
          <type>28</type>
        </param>
        <param>
          <type>29</type>
        </param>
        <param>
          <type>31</type>
        </param>
        <param>
          <type>32</type>
        </param>
        <param>
          <type>34</type>
        </param>
        <param>
          <type>35</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="21" column="1"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a4e517ff0968a4a6f99d0aafa37e402cd" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>__EEPROM_DATA</definition>
        <argsstring>(37, 38, 40, 41, 43, 44, 45, 47)</argsstring>
        <name>__EEPROM_DATA</name>
        <param>
          <type>37</type>
        </param>
        <param>
          <type>38</type>
        </param>
        <param>
          <type>40</type>
        </param>
        <param>
          <type>41</type>
        </param>
        <param>
          <type>43</type>
        </param>
        <param>
          <type>44</type>
        </param>
        <param>
          <type>45</type>
        </param>
        <param>
          <type>47</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="22" column="1"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1aba4a6818ab60f0a61940944cc6e0cddd" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>__EEPROM_DATA</definition>
        <argsstring>(48, 50, 51, 52, 54, 55, 56, 58)</argsstring>
        <name>__EEPROM_DATA</name>
        <param>
          <type>48</type>
        </param>
        <param>
          <type>50</type>
        </param>
        <param>
          <type>51</type>
        </param>
        <param>
          <type>52</type>
        </param>
        <param>
          <type>54</type>
        </param>
        <param>
          <type>55</type>
        </param>
        <param>
          <type>56</type>
        </param>
        <param>
          <type>58</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="23" column="1"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1ae66e7f511735e1a1b5c7fec8e017511e" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>__EEPROM_DATA</definition>
        <argsstring>(59, 60, 61, 63, 64, 65, 66, 67)</argsstring>
        <name>__EEPROM_DATA</name>
        <param>
          <type>59</type>
        </param>
        <param>
          <type>60</type>
        </param>
        <param>
          <type>61</type>
        </param>
        <param>
          <type>63</type>
        </param>
        <param>
          <type>64</type>
        </param>
        <param>
          <type>65</type>
        </param>
        <param>
          <type>66</type>
        </param>
        <param>
          <type>67</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="24" column="1"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a01df7d06b91e149f05e0fc75bfa57d33" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>__EEPROM_DATA</definition>
        <argsstring>(68, 70, 71, 72, 73, 74, 75, 76)</argsstring>
        <name>__EEPROM_DATA</name>
        <param>
          <type>68</type>
        </param>
        <param>
          <type>70</type>
        </param>
        <param>
          <type>71</type>
        </param>
        <param>
          <type>72</type>
        </param>
        <param>
          <type>73</type>
        </param>
        <param>
          <type>74</type>
        </param>
        <param>
          <type>75</type>
        </param>
        <param>
          <type>76</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="25" column="1"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a97e03abdbb2ceba6aebeaedb0e932f3b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>__EEPROM_DATA</definition>
        <argsstring>(77, 78, 79, 80, 81, 82, 83, 84)</argsstring>
        <name>__EEPROM_DATA</name>
        <param>
          <type>77</type>
        </param>
        <param>
          <type>78</type>
        </param>
        <param>
          <type>79</type>
        </param>
        <param>
          <type>80</type>
        </param>
        <param>
          <type>81</type>
        </param>
        <param>
          <type>82</type>
        </param>
        <param>
          <type>83</type>
        </param>
        <param>
          <type>84</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="26" column="1"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a366a1e1813bcfd9903d30070830f56f9" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>__EEPROM_DATA</definition>
        <argsstring>(84, 85, 86, 87, 88, 88, 89, 90)</argsstring>
        <name>__EEPROM_DATA</name>
        <param>
          <type>84</type>
        </param>
        <param>
          <type>85</type>
        </param>
        <param>
          <type>86</type>
        </param>
        <param>
          <type>87</type>
        </param>
        <param>
          <type>88</type>
        </param>
        <param>
          <type>88</type>
        </param>
        <param>
          <type>89</type>
        </param>
        <param>
          <type>90</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="27" column="1"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a878c39524bced3706ad196ed455087a2" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>__EEPROM_DATA</definition>
        <argsstring>(90, 91, 92, 92, 93, 94, 94, 95)</argsstring>
        <name>__EEPROM_DATA</name>
        <param>
          <type>90</type>
        </param>
        <param>
          <type>91</type>
        </param>
        <param>
          <type>92</type>
        </param>
        <param>
          <type>92</type>
        </param>
        <param>
          <type>93</type>
        </param>
        <param>
          <type>94</type>
        </param>
        <param>
          <type>94</type>
        </param>
        <param>
          <type>95</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="28" column="1"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a0bfcbe82c6b6d3123573240f9c75d4ca" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>__EEPROM_DATA</definition>
        <argsstring>(95, 96, 96, 96, 97, 97, 98, 98)</argsstring>
        <name>__EEPROM_DATA</name>
        <param>
          <type>95</type>
        </param>
        <param>
          <type>96</type>
        </param>
        <param>
          <type>96</type>
        </param>
        <param>
          <type>96</type>
        </param>
        <param>
          <type>97</type>
        </param>
        <param>
          <type>97</type>
        </param>
        <param>
          <type>98</type>
        </param>
        <param>
          <type>98</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="29" column="1"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a73e015812d8d8cf671dda37e2619c807" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>__EEPROM_DATA</definition>
        <argsstring>(98, 99, 99, 99, 99, 99, 100, 100)</argsstring>
        <name>__EEPROM_DATA</name>
        <param>
          <type>98</type>
        </param>
        <param>
          <type>99</type>
        </param>
        <param>
          <type>99</type>
        </param>
        <param>
          <type>99</type>
        </param>
        <param>
          <type>99</type>
        </param>
        <param>
          <type>99</type>
        </param>
        <param>
          <type>100</type>
        </param>
        <param>
          <type>100</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="30" column="1"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a7c267c2edfcff31a2760dd095809d786" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type></type>
        <definition>__EEPROM_DATA</definition>
        <argsstring>(100, 100, 100, 100, 100, 0, 0, 0)</argsstring>
        <name>__EEPROM_DATA</name>
        <param>
          <type>100</type>
        </param>
        <param>
          <type>100</type>
        </param>
        <param>
          <type>100</type>
        </param>
        <param>
          <type>100</type>
        </param>
        <param>
          <type>100</type>
        </param>
        <param>
          <type>0</type>
        </param>
        <param>
          <type>0</type>
        </param>
        <param>
          <type>0</type>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="31" column="1"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a4c3b7689564254274a0e3a2a1771d473" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void initPins</definition>
        <argsstring>()</argsstring>
        <name>initPins</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Prepares the ports of the processor. No device may be turned on. They only &quot;exception&quot; to this rule is the Display, which uses shift registers for storing it&apos;s information, it is cleared after all other initialisation steps have been finished. This Method also activates the pull up resistor and sets the operation frequency to 32MHz. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="63" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="63" bodyend="91"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1ab3166bd1ba3160d3bac85daddb12f947" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void initADC</definition>
        <argsstring>()</argsstring>
        <name>initADC</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Prepare the ADC module for operation. The positive reference is set to Vdd, while the negative one is set to Vss. The conversion clock speed is set to FOSC/64 since the SampleHold - Capacitor would otherwise not be fully charged and unexpected results would be the consequence. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="97" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="97" bodyend="116"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a4d4bd39a8d9a35c69d0274fd272bc1d4" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void initTMR2</definition>
        <argsstring>()</argsstring>
        <name>initTMR2</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Prepares the Timer 2 as an refresh-rate generator. This functionality is, as of now, not used and not vital to the operation of the device. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="122" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="122" bodyend="161"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1ac54dcca941c1bea6b7bc3d8babb5aaaf" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void initTMR1</definition>
        <argsstring>()</argsstring>
        <name>initTMR1</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Timer 1 is set up with a resolution of 250ns. It is used to measure the phase delay between Current and Voltage. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="166" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="166" bodyend="191"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a0103fec987197d5a370a762edbe779e7" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void initFVR</definition>
        <argsstring>()</argsstring>
        <name>initFVR</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>initializes both Buffers to 1.024Volts. The first one is needed to measure Vdd with the ADC-Module, the second one is used to provide the comparator with a voltage to compare the Voltage against. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="196" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="196" bodyend="215"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a990271cb1bf71a9ad908cf95daf1eb6b" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void initPWMTMR4</definition>
        <argsstring>()</argsstring>
        <name>initPWMTMR4</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Prepares the PWM with Timer 4. This PWM is used to provide the second reference to the second comparator, which is used for the current. Since the voltage, representing the current is small, we need to have a precise reference, this we used a PWM with a low-pass filter of second order to create a direct current. The Output is switched from RB3 to RB0. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="222" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="222" bodyend="265"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1ae0b5b4551a6c8f5e5cd0bc1f8f07a8c6" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void initCOMP1</definition>
        <argsstring>()</argsstring>
        <name>initCOMP1</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Sets up the Comparator 1 Module for measuring the phase of the Voltage. The Interrupt is set to fire on falling edges only. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="282" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="282" bodyend="310"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1acc739909b6a4e417b9af88738e662987" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void initCOMP2</definition>
        <argsstring>()</argsstring>
        <name>initCOMP2</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Sets up the Comparator 2 Module for measuring the phase of the Current. The Interrupt is set to fire on falling edges only. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="316" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="316" bodyend="343"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a1937a1a69f27dd9e91c099e4429731be" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void initBT</definition>
        <argsstring>()</argsstring>
        <name>initBT</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Configures the USART Module as asynchronous with an baud rate of 9600 and clears all previously received data. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="349" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="349" bodyend="376"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a4fbdf44d733d619a014a5a6f2315700d" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void adc</definition>
        <argsstring>(const int8_t src)</argsstring>
        <name>adc</name>
        <param>
          <type>const int8_t</type>
          <declname>src</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Performs an AD-Conversion on the specified source. The Sources AN0 to AN11 are proportional to the source specified (setting src to 4 will read from AN4). Also the source for the FVR-Buffer1 can be selected, which is 0x1f;</para><para><parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>src</parametername>
</parameternamelist>
<parameterdescription>
<para>the source from which to convert </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="388" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="388" bodyend="423"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1abad6c151b93f88becacb00a6f3727416" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>uint8_t</type>
        <definition>uint8_t readVoltage</definition>
        <argsstring>()</argsstring>
        <name>readVoltage</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>This method is a placeholder method and was written, in case a Voltage measurement was to be implemented. In it&apos;s current state it returns the value of 230Volts. <simplesect kind="return"><para>the line voltage (about 230V in Europe) </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="432" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="432" bodyend="435"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a69737966a3174628c469a37d6db002a7" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int24_t</type>
        <definition>int24_t readCurrent</definition>
        <argsstring>()</argsstring>
        <name>readCurrent</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Measures the current which is currently flowing and returns it in mA as Integer to provide an accurate result, without the implications of using floats. The channel from which the measurement is taken is AN7. <simplesect kind="return"><para>the measured current in mAmps. </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="442" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="442" bodyend="457"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1aac2b18361514a260b77f367bb12fa77a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>uint16_t</type>
        <definition>uint16_t readVdd</definition>
        <argsstring>()</argsstring>
        <name>readVdd</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Measures Vdd and returns it as an Integer in the range of 0 to 1023. This is useful, because the calculation of the current is a lot easier if first the conversion from all 10 bit values to more reasonable ones is done and only then the currect value computed. <simplesect kind="return"><para>the supply voltage from 0 to 1023 where 0 = 0V and 1023 = 5V </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="459" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="459" bodyend="469"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a0f26c0064b568a85c7be468e2235a2f4" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void so</definition>
        <argsstring>(const uint8_t data)</argsstring>
        <name>so</name>
        <param>
          <type>const uint8_t</type>
          <declname>data</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Shifts one byte of data into the shift registers with the least significant bit first. <parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>data</parametername>
</parameternamelist>
<parameterdescription>
<para>the data to write into the shift register </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="477" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="477" bodyend="493"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a8f35dad172390f2c99bf58f71c4fe2fb" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void clearDisplay</definition>
        <argsstring>(int8_t leng)</argsstring>
        <name>clearDisplay</name>
        <param>
          <type>int8_t</type>
          <declname>leng</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Clears the display by writing 0xff into every shift register. <parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>leng</parametername>
</parameternamelist>
<parameterdescription>
<para>the number of registers </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="498" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="498" bodyend="502"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a36e528b890c7edbb7b9eb0c61d725bef" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void sendColour</definition>
        <argsstring>(uint8_t c)</argsstring>
        <name>sendColour</name>
        <param>
          <type>uint8_t</type>
          <defname>c</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Sends one byte of colour information to the status led. Since the colour depends on the write order this function does not specify the colour of the LED. <parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>the</parametername>
</parameternamelist>
<parameterdescription>
<para>intensity of the colour </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="508" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="508" bodyend="533"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1aa7e5cea063dbb34802dda31333eaef58" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>uint16_t</type>
        <definition>uint16_t deltaT</definition>
        <argsstring>(uint16_t tm_low, uint16_t tm_high)</argsstring>
        <name>deltaT</name>
        <param>
          <type>uint16_t</type>
          <declname>tm_low</declname>
        </param>
        <param>
          <type>uint16_t</type>
          <declname>tm_high</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Computes the time difference of the two times. Tm_low is the time, which came chronologically before tm_high. Since these values are the values of Timer 1 at set time it could be, that tm_low&gt;tm_high, if this is the case the difference will be computed as follos: 0xffff - tm_low + tm_high; otherwise the difference is simply tm_high-tm_low. <parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>tm_low</parametername>
</parameternamelist>
<parameterdescription>
<para>the chronologically first value </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>tm_high</parametername>
</parameternamelist>
<parameterdescription>
<para>the chronologically second value </para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>the time difference in 250nano seconds </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="543" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="543" bodyend="549"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a49011b67fdd3b5aa99c5305c4def8688" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int8_t</type>
        <definition>int8_t sin_</definition>
        <argsstring>(int8_t z)</argsstring>
        <name>sin_</name>
        <param>
          <type>int8_t</type>
          <declname>z</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Reads the sine from the eeprom. It is important to note, that not 360° represent a full rotation, but rather 400°. Since not every value can be stored in the eeprom (it is also not needed) it reads only the value from 0 to 100°. <parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>z</parametername>
</parameternamelist>
<parameterdescription>
<para>the angle in grad (not deg!) </para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>the sine multiplied by 100 </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="551" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="551" bodyend="554"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1ad09cda1044ebc5675a9b462e5a11978a" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int8_t</type>
        <definition>int8_t sin</definition>
        <argsstring>(int16_t z)</argsstring>
        <name>sin</name>
        <param>
          <type>int16_t</type>
          <declname>z</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Computes values of the sine, which are not covered by <ref refid="powerspy_8h_1a49011b67fdd3b5aa99c5305c4def8688" kindref="member">sin_()</ref>. <parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>z</parametername>
</parameternamelist>
<parameterdescription>
<para>the angle in grad (not deg!) </para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>the sine multiplied by 100 </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="558" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="558" bodyend="583"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a77f641354d808eb7adbb519a724d4027" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>int8_t</type>
        <definition>int8_t cos</definition>
        <argsstring>(int16_t us)</argsstring>
        <name>cos</name>
        <param>
          <type>int16_t</type>
          <declname>z</declname>
          <defname>us</defname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Behaves in the exactly same way as <ref refid="powerspy_8h_1ad09cda1044ebc5675a9b462e5a11978a" kindref="member">sin()</ref> but returns the cosine. <parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>z</parametername>
</parameternamelist>
<parameterdescription>
<para>the angle ing grad (not deg!) </para></parameterdescription>
</parameteritem>
</parameterlist>
<simplesect kind="return"><para>the cosine multiplied by 100 </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="585" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="585" bodyend="588"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1ab6dcfeb080c4fc27b28b9ac99b9a8aa8" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>uint8_t</type>
        <definition>uint8_t ledReset</definition>
        <argsstring>()</argsstring>
        <name>ledReset</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Evaluates if the LED value can be rewritten (the LED needs a reset time of 50us). If these 50us have passed since the last write to the LED this method returns 1 otherwise 0. <simplesect kind="return"><para>a flag if the LED can be rewritten </para></simplesect>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="590" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="590" bodyend="601"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1aa76a726af97e61c931dc5c48da533842" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void setLED</definition>
        <argsstring>(uint8_t g, uint8_t r, uint8_t b)</argsstring>
        <name>setLED</name>
        <param>
          <type>uint8_t</type>
          <declname>g</declname>
        </param>
        <param>
          <type>uint8_t</type>
          <declname>r</declname>
        </param>
        <param>
          <type>uint8_t</type>
          <declname>b</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Writes a colour to the LED. The led is programmed with an rgb profile. <parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>g</parametername>
</parameternamelist>
<parameterdescription>
<para>the green colour intensity </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>r</parametername>
</parameternamelist>
<parameterdescription>
<para>the red colour intensity </para></parameterdescription>
</parameteritem>
<parameteritem>
<parameternamelist>
<parametername>b</parametername>
</parameternamelist>
<parameterdescription>
<para>the blue colour intensity </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="606" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="606" bodyend="612"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1ae516f2ff48d3fcf8c5fd638c92878e66" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void setUnit</definition>
        <argsstring>(uint24_t u)</argsstring>
        <name>setUnit</name>
        <param>
          <type>uint24_t</type>
          <declname>u</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Writes a specified unit into the shift registers. Note, that all following registers need to be filled, in order for these values to appear in the correct register. <parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>u</parametername>
</parameternamelist>
<parameterdescription>
<para>the unit to write into the registers </para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="614" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="614" bodyend="619"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1ac2e00b08576dfbc9457a38a93daf5cf7" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void setVal</definition>
        <argsstring>(int16_t v)</argsstring>
        <name>setVal</name>
        <param>
          <type>int16_t</type>
          <declname>v</declname>
        </param>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>Writes the Integer value into the registers. Typically <ref refid="powerspy_8h_1ae516f2ff48d3fcf8c5fd638c92878e66" kindref="member">setUnit()</ref> is called prior to this function and only after this function has been called the display will output reasonable values. <parameterlist kind="param"><parameteritem>
<parameternamelist>
<parametername>v</parametername>
</parameternamelist>
<parameterdescription>
<para></para></parameterdescription>
</parameteritem>
</parameterlist>
</para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="621" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="621" bodyend="628"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1a085e1179e1a03b59da3a42398e8f86f5" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void __interrupt</type>
        <definition>void __interrupt ISR</definition>
        <argsstring>()</argsstring>
        <name>ISR</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
<para>The interrupt service routine. It handles incoming data and the phases of current and voltage. </para>        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="630" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="630" bodyend="672"/>
      </memberdef>
      <memberdef kind="function" id="powerspy_8c_1acdef7a1fd863a6d3770c1268cb06add3" prot="public" static="no" const="no" explicit="no" inline="no" virt="non-virtual">
        <type>void</type>
        <definition>void main</definition>
        <argsstring>()</argsstring>
        <name>main</name>
        <briefdescription>
        </briefdescription>
        <detaileddescription>
        </detaileddescription>
        <inbodydescription>
        </inbodydescription>
        <location file="powerspy.X/powerspy.c" line="677" column="1" bodyfile="powerspy.X/powerspy.c" bodystart="677" bodyend="798"/>
      </memberdef>
      </sectiondef>
    <briefdescription>
    </briefdescription>
    <detaileddescription>
    </detaileddescription>
    <programlisting>
<codeline lineno="1"><highlight class="comment">/*</highlight></codeline>
<codeline lineno="2"><highlight class="comment"><sp/>*<sp/>File:<sp/><sp/><sp/>powerspy.c</highlight></codeline>
<codeline lineno="3"><highlight class="comment"><sp/>*<sp/>Author:<sp/>Manuel<sp/>Federanko</highlight></codeline>
<codeline lineno="4"><highlight class="comment"><sp/>*</highlight></codeline>
<codeline lineno="5"><highlight class="comment"><sp/>*<sp/>Created<sp/>on<sp/>27<sp/>November<sp/>2015,<sp/>18:58</highlight></codeline>
<codeline lineno="6"><highlight class="comment"><sp/>*<sp/></highlight></codeline>
<codeline lineno="7"><highlight class="comment"><sp/>*<sp/>All<sp/>information<sp/>regarding<sp/>correlation<sp/>between<sp/>pins,<sp/>registers<sp/>and<sp/>such</highlight></codeline>
<codeline lineno="8"><highlight class="comment"><sp/>*<sp/>has<sp/>been<sp/>taken<sp/>from<sp/>microchips<sp/>data<sp/>sheet<sp/>for<sp/>PIC16(L)F1826/27<sp/>(DS41391D)</highlight></codeline>
<codeline lineno="9"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="10"><highlight class="normal"></highlight></codeline>
<codeline lineno="11"><highlight class="normal"></highlight></codeline>
<codeline lineno="12"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;xc.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="13"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&lt;limits.h&gt;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="14"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="types_8h" kindref="compound">types.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="15"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="message_8h" kindref="compound">message.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="16"><highlight class="normal"></highlight><highlight class="preprocessor">#include<sp/>&quot;<ref refid="powerspy_8h" kindref="compound">powerspy.h</ref>&quot;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="17"><highlight class="normal"></highlight></codeline>
<codeline lineno="18"><highlight class="normal"></highlight><highlight class="comment">//sin<sp/>in<sp/>scale<sp/>of<sp/>0<sp/>to<sp/>100</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="19"><highlight class="normal">__EEPROM_DATA(0,<sp/>2,<sp/>3,<sp/>5,<sp/>6,<sp/>8,<sp/>9,<sp/>11);</highlight></codeline>
<codeline lineno="20"><highlight class="normal">__EEPROM_DATA(13,<sp/>14,<sp/>16,<sp/>17,<sp/>19,<sp/>20,<sp/>22,<sp/>23);</highlight></codeline>
<codeline lineno="21"><highlight class="normal">__EEPROM_DATA(25,<sp/>26,<sp/>28,<sp/>29,<sp/>31,<sp/>32,<sp/>34,<sp/>35);</highlight></codeline>
<codeline lineno="22"><highlight class="normal">__EEPROM_DATA(37,<sp/>38,<sp/>40,<sp/>41,<sp/>43,<sp/>44,<sp/>45,<sp/>47);</highlight></codeline>
<codeline lineno="23"><highlight class="normal">__EEPROM_DATA(48,<sp/>50,<sp/>51,<sp/>52,<sp/>54,<sp/>55,<sp/>56,<sp/>58);</highlight></codeline>
<codeline lineno="24"><highlight class="normal">__EEPROM_DATA(59,<sp/>60,<sp/>61,<sp/>63,<sp/>64,<sp/>65,<sp/>66,<sp/>67);</highlight></codeline>
<codeline lineno="25"><highlight class="normal">__EEPROM_DATA(68,<sp/>70,<sp/>71,<sp/>72,<sp/>73,<sp/>74,<sp/>75,<sp/>76);</highlight></codeline>
<codeline lineno="26"><highlight class="normal">__EEPROM_DATA(77,<sp/>78,<sp/>79,<sp/>80,<sp/>81,<sp/>82,<sp/>83,<sp/>84);</highlight></codeline>
<codeline lineno="27"><highlight class="normal">__EEPROM_DATA(84,<sp/>85,<sp/>86,<sp/>87,<sp/>88,<sp/>88,<sp/>89,<sp/>90);</highlight></codeline>
<codeline lineno="28"><highlight class="normal">__EEPROM_DATA(90,<sp/>91,<sp/>92,<sp/>92,<sp/>93,<sp/>94,<sp/>94,<sp/>95);</highlight></codeline>
<codeline lineno="29"><highlight class="normal">__EEPROM_DATA(95,<sp/>96,<sp/>96,<sp/>96,<sp/>97,<sp/>97,<sp/>98,<sp/>98);</highlight></codeline>
<codeline lineno="30"><highlight class="normal">__EEPROM_DATA(98,<sp/>99,<sp/>99,<sp/>99,<sp/>99,<sp/>99,<sp/>100,<sp/>100);</highlight></codeline>
<codeline lineno="31"><highlight class="normal">__EEPROM_DATA(100,<sp/>100,<sp/>100,<sp/>100,<sp/>100,<sp/>0,<sp/>0,<sp/>0);</highlight></codeline>
<codeline lineno="32"><highlight class="normal"></highlight></codeline>
<codeline lineno="33"><highlight class="normal"></highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint8_t<sp/>get_shift_byte[10]<sp/>=<sp/>{NR0,<sp/>NR1,<sp/>NR2,<sp/>NR3,<sp/>NR4,<sp/>NR5,<sp/>NR6,<sp/>NR7,<sp/>NR8,<sp/>NR9};</highlight></codeline>
<codeline lineno="34"><highlight class="normal"></highlight></codeline>
<codeline lineno="35"><highlight class="normal"></highlight></codeline>
<codeline lineno="36"><highlight class="normal"></highlight><highlight class="comment">//remember<sp/>interrupt<sp/>time<sp/>for<sp/>deltat</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="37"><highlight class="normal">uint16_t<sp/>volt_time<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="38"><highlight class="normal">uint16_t<sp/>curr_time<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="39"><highlight class="normal"></highlight></codeline>
<codeline lineno="40"><highlight class="normal"></highlight><highlight class="comment">//0th<sp/>bit:<sp/>volts<sp/>set</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="41"><highlight class="normal"></highlight><highlight class="comment">//1st<sp/>bit:<sp/>current<sp/>set</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="42"><highlight class="normal"></highlight><highlight class="comment">//2nd<sp/>bit:<sp/>volts<sp/>first</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="43"><highlight class="normal"></highlight><highlight class="comment">//3rd<sp/>bit:<sp/>current<sp/>first</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="44"><highlight class="normal"></highlight><highlight class="comment">//4th<sp/>bit:<sp/>button</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="45"><highlight class="normal"></highlight><highlight class="keyword">volatile</highlight><highlight class="normal"><sp/>uint8_t<sp/>flag<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="46"><highlight class="normal"></highlight></codeline>
<codeline lineno="47"><highlight class="normal"></highlight><highlight class="comment">//config<sp/>for<sp/>current<sp/>measurement</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="48"><highlight class="normal">int24_t<sp/>i_u_offs<sp/>=<sp/>-12500;</highlight></codeline>
<codeline lineno="49"><highlight class="normal">uint8_t<sp/>i_u_diode_offs<sp/>=<sp/>7;</highlight></codeline>
<codeline lineno="50"><highlight class="normal"></highlight></codeline>
<codeline lineno="51"><highlight class="normal">uint16_t<sp/>led_rest<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="52"><highlight class="normal"></highlight></codeline>
<codeline lineno="53"><highlight class="normal"></highlight><highlight class="keyword">volatile</highlight><highlight class="normal"><sp/>uint8_t<sp/>mode<sp/>=<sp/>DMODE_NONE;</highlight></codeline>
<codeline lineno="54"><highlight class="normal"></highlight></codeline>
<codeline lineno="55"><highlight class="normal"></highlight><highlight class="comment">/******************************************************************************</highlight></codeline>
<codeline lineno="56"><highlight class="comment"><sp/>*init<sp/>methods*****************************************************************</highlight></codeline>
<codeline lineno="57"><highlight class="comment"><sp/>******************************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="58"><highlight class="normal"></highlight></codeline>
<codeline lineno="59"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="60"><highlight class="comment"><sp/>*<sp/>prepare<sp/>the<sp/>processor,<sp/>nothing<sp/>may<sp/>be<sp/>turned<sp/>on</highlight></codeline>
<codeline lineno="61"><highlight class="comment"><sp/>*<sp/>according<sp/>to<sp/>Pinlayout<sp/>version<sp/>1.4</highlight></codeline>
<codeline lineno="62"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="63"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="powerspy_8h_1a4c3b7689564254274a0e3a2a1771d473" kindref="member">initPins</ref>()</highlight></codeline>
<codeline lineno="64"><highlight class="normal">{</highlight></codeline>
<codeline lineno="65"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>PORTA<sp/>=<sp/>0b00000000;</highlight></codeline>
<codeline lineno="66"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ANSELA<sp/>=<sp/>0b00000111;</highlight></codeline>
<codeline lineno="67"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TRISA<sp/>=<sp/>0b00000111;</highlight></codeline>
<codeline lineno="68"><highlight class="normal"></highlight></codeline>
<codeline lineno="69"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>PORTB<sp/>=<sp/>0b00000000;</highlight></codeline>
<codeline lineno="70"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ANSELB<sp/>=<sp/>0b00110000;</highlight></codeline>
<codeline lineno="71"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TRISB<sp/>=<sp/>0b00111010;</highlight></codeline>
<codeline lineno="72"><highlight class="normal"></highlight></codeline>
<codeline lineno="73"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>nWPUEN<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="74"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>WPUB<sp/>=<sp/>0b00001000;</highlight></codeline>
<codeline lineno="75"><highlight class="normal"></highlight></codeline>
<codeline lineno="76"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//see<sp/>data<sp/>sheet<sp/>page<sp/>65<sp/>&amp;<sp/>58<sp/>FOSC<sp/>set<sp/>in<sp/>pragmas</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="77"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>the<sp/>frequency<sp/>to<sp/>32MHz</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="78"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SCS0<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="79"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SCS1<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="80"><highlight class="normal"></highlight></codeline>
<codeline lineno="81"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>IRCF0<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="82"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>IRCF1<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="83"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>IRCF2<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="84"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>IRCF3<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="85"><highlight class="normal"></highlight></codeline>
<codeline lineno="86"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SPLLEN<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="87"><highlight class="normal"></highlight></codeline>
<codeline lineno="88"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//config<sp/>int<sp/>for<sp/>RB5<sp/>(see<sp/>data<sp/>sheet<sp/>page<sp/>81)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="89"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>IOCBN5<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="90"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>IOCIE<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="91"><highlight class="normal">}</highlight></codeline>
<codeline lineno="92"><highlight class="normal"></highlight></codeline>
<codeline lineno="93"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="94"><highlight class="comment"><sp/>*<sp/>set<sp/>up<sp/>the<sp/>adc<sp/>for<sp/>an<sp/>8<sp/>bit<sp/>conversion</highlight></codeline>
<codeline lineno="95"><highlight class="comment"><sp/>*<sp/>with<sp/>Vdd<sp/>and<sp/>Vss<sp/>as<sp/>references</highlight></codeline>
<codeline lineno="96"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="97"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="powerspy_8h_1ab3166bd1ba3160d3bac85daddb12f947" kindref="member">initADC</ref>()</highlight></codeline>
<codeline lineno="98"><highlight class="normal">{</highlight></codeline>
<codeline lineno="99"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//see<sp/>page<sp/>139<sp/>of<sp/>datasheet</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="100"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//left<sp/>justify,<sp/>we<sp/>have<sp/>a<sp/>resolution<sp/>of<sp/>10<sp/>bit,<sp/>8<sp/>bit<sp/>in<sp/>ADRESH</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="101"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ADFM<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="102"><highlight class="normal"></highlight></codeline>
<codeline lineno="103"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//see<sp/>data<sp/>sheet<sp/>page<sp/>146</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="104"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>the<sp/>conversion<sp/>clock<sp/>speed<sp/>to<sp/>FOSC/64</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="105"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ADCS0<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="106"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ADCS1<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="107"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ADCS2<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="108"><highlight class="normal"></highlight></codeline>
<codeline lineno="109"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//see<sp/>data<sp/>sheet<sp/>page<sp/>146<sp/>||<sp/>139</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="110"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>the<sp/>references<sp/>to<sp/>Vdd<sp/>and<sp/>Vss</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="111"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ADPREF0<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="112"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ADPREF1<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="113"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ADNREF<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="114"><highlight class="normal"></highlight></codeline>
<codeline lineno="115"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ADON<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="116"><highlight class="normal">}</highlight></codeline>
<codeline lineno="117"><highlight class="normal"></highlight></codeline>
<codeline lineno="118"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="119"><highlight class="comment"><sp/>*<sp/>this<sp/>timer<sp/>might<sp/>be<sp/>used<sp/>as<sp/>a<sp/>screen<sp/>refresch<sp/>rate<sp/>generator</highlight></codeline>
<codeline lineno="120"><highlight class="comment"><sp/>*<sp/>in<sp/>a<sp/>later<sp/>release</highlight></codeline>
<codeline lineno="121"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="122"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="powerspy_8h_1a4d4bd39a8d9a35c69d0274fd272bc1d4" kindref="member">initTMR2</ref>()</highlight></codeline>
<codeline lineno="123"><highlight class="normal">{</highlight></codeline>
<codeline lineno="124"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="125"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>prescaler<sp/>vals<sp/>for<sp/>timers<sp/>2/4/6</highlight></codeline>
<codeline lineno="126"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>overflow_freq(*)<sp/>=<sp/>fosc_val/UCHAR_MAX</highlight></codeline>
<codeline lineno="127"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/></highlight></codeline>
<codeline lineno="128"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>*calculated<sp/>with<sp/>_XTAL_FREQ<sp/>=<sp/>4_000_000</highlight></codeline>
<codeline lineno="129"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/><sp/></highlight></codeline>
<codeline lineno="130"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|TxCKPS1|TxCKPS0|PRESCALER|FOSC_VAL|OVERFLOW_FREQ|RATE@50|</highlight></codeline>
<codeline lineno="131"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|-------|-------|---------|--------|-------------|-------|</highlight></codeline>
<codeline lineno="132"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/><sp/>0|<sp/><sp/><sp/><sp/><sp/><sp/>0|<sp/><sp/><sp/><sp/><sp/><sp/>1:1|<sp/><sp/>FOSC/4|<sp/><sp/><sp/><sp/><sp/><sp/><sp/>15_625|<sp/><sp/>312.5|</highlight></codeline>
<codeline lineno="133"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/><sp/>0|<sp/><sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/><sp/><sp/>1:4|<sp/>FOSC/16|<sp/><sp/><sp/><sp/><sp/>3_906.25|<sp/>78.125|</highlight></codeline>
<codeline lineno="134"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/><sp/><sp/>0|<sp/><sp/><sp/><sp/><sp/>1:16|<sp/>FOSC/64|<sp/><sp/><sp/><sp/><sp/><sp/>976.562|19.5312|</highlight></codeline>
<codeline lineno="135"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/><sp/>1:64|FOSC/256|<sp/><sp/><sp/><sp/><sp/><sp/>244.141|4.88282|</highlight></codeline>
<codeline lineno="136"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/></highlight></codeline>
<codeline lineno="137"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="138"><highlight class="normal"></highlight></codeline>
<codeline lineno="139"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//see<sp/>data<sp/>sheet<sp/>page<sp/>189<sp/>&amp;<sp/>191</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="140"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>the<sp/>prescaler<sp/>to<sp/>1:4<sp/>to<sp/>get<sp/>a<sp/>rate<sp/>of<sp/>~80</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="141"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T2CKPS0<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="142"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T2CKPS1<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="143"><highlight class="normal"></highlight></codeline>
<codeline lineno="144"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//see<sp/>data<sp/>sheet<sp/>page<sp/>189<sp/>&amp;<sp/>191</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="145"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>the<sp/>postscaler<sp/>to<sp/>1:1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="146"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T2OUTPS0<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="147"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T2OUTPS1<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="148"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T2OUTPS2<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="149"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T2OUTPS3<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="150"><highlight class="normal"></highlight></codeline>
<codeline lineno="151"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//see<sp/>data<sp/>sheet<sp/>page<sp/>190</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="152"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//defaults<sp/>to<sp/>0xff<sp/>on<sp/>reset,<sp/>i<sp/>want<sp/>to<sp/>be<sp/>clear<sp/>of<sp/>what<sp/>i<sp/>want</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="153"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>PR2<sp/>=<sp/>0xff;</highlight></codeline>
<codeline lineno="154"><highlight class="normal"></highlight></codeline>
<codeline lineno="155"><highlight class="normal"></highlight></codeline>
<codeline lineno="156"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TMR2IE<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="157"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TMR2IF<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="158"><highlight class="normal"></highlight></codeline>
<codeline lineno="159"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//see<sp/>data<sp/>sheet<sp/>page<sp/>191</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="160"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TMR2ON<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="161"><highlight class="normal">}</highlight></codeline>
<codeline lineno="162"><highlight class="normal"></highlight></codeline>
<codeline lineno="163"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="164"><highlight class="comment"><sp/>*<sp/>used<sp/>to<sp/>measure<sp/>real<sp/>time<sp/>for<sp/>deltat<sp/>and<sp/>the<sp/>led</highlight></codeline>
<codeline lineno="165"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="166"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="powerspy_8h_1ac54dcca941c1bea6b7bc3d8babb5aaaf" kindref="member">initTMR1</ref>()</highlight></codeline>
<codeline lineno="167"><highlight class="normal">{</highlight></codeline>
<codeline lineno="168"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="169"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>see<sp/>data<sp/>sheet<sp/>page<sp/>177</highlight></codeline>
<codeline lineno="170"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>set<sp/>the<sp/>clock<sp/>source</highlight></codeline>
<codeline lineno="171"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|TMR1CS1|TMR1CS0|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CLK<sp/>SRC|</highlight></codeline>
<codeline lineno="172"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|------:|------:|--------------------:|</highlight></codeline>
<codeline lineno="173"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/><sp/>0|<sp/><sp/><sp/><sp/><sp/><sp/>0|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FOSC/4|</highlight></codeline>
<codeline lineno="174"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/><sp/>0|<sp/><sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FOSC|</highlight></codeline>
<codeline lineno="175"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/><sp/><sp/>0|External<sp/>CLK<sp/>on<sp/>T1CKI|</highlight></codeline>
<codeline lineno="176"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>Cap.<sp/>S.<sp/>OSC|</highlight></codeline>
<codeline lineno="177"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="178"><highlight class="normal"></highlight></codeline>
<codeline lineno="179"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TMR1CS0<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="180"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TMR1CS1<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="181"><highlight class="normal"></highlight></codeline>
<codeline lineno="182"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>prescaler,<sp/>ranges<sp/>from<sp/>1<sp/>-<sp/>8</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="183"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//we<sp/>have<sp/>a<sp/>frequency<sp/>of<sp/>32MHz<sp/>with<sp/>prescale<sp/>of<sp/>2<sp/>(FOSC/8<sp/>=<sp/>4MHz)<sp/>--&gt;<sp/>dt<sp/>=<sp/>1/4MHz<sp/>=<sp/>250ns<sp/>(real<sp/>time,<sp/>nice)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="184"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T1CKPS0<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="185"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T1CKPS1<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="186"><highlight class="normal"></highlight></codeline>
<codeline lineno="187"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TMR1IE<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="188"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TMR1IF<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="189"><highlight class="normal"></highlight></codeline>
<codeline lineno="190"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TMR1ON<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="191"><highlight class="normal">}</highlight></codeline>
<codeline lineno="192"><highlight class="normal"></highlight></codeline>
<codeline lineno="193"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="194"><highlight class="comment"><sp/>*<sp/>used<sp/>to<sp/>compare<sp/>to<sp/>voltage<sp/>signal</highlight></codeline>
<codeline lineno="195"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="196"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="powerspy_8h_1a0103fec987197d5a370a762edbe779e7" kindref="member">initFVR</ref>()</highlight></codeline>
<codeline lineno="197"><highlight class="normal">{</highlight></codeline>
<codeline lineno="198"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="199"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|CDAFVR1|CDAFVR0|VOLTS|</highlight></codeline>
<codeline lineno="200"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|------:|------:|----:|</highlight></codeline>
<codeline lineno="201"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/><sp/>0|<sp/><sp/><sp/><sp/><sp/><sp/>0|1.024|</highlight></codeline>
<codeline lineno="202"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/><sp/>0|<sp/><sp/><sp/><sp/><sp/><sp/>1|2.048|</highlight></codeline>
<codeline lineno="203"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/><sp/><sp/>0|4.096|</highlight></codeline>
<codeline lineno="204"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/>-|</highlight></codeline>
<codeline lineno="205"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="206"><highlight class="normal"></highlight></codeline>
<codeline lineno="207"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>the<sp/>fvr<sp/>for<sp/>adc<sp/>to<sp/>1.024<sp/>volts</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="208"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ADFVR0<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="209"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ADFVR1<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="210"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>FVR<sp/>Buffer2<sp/>for<sp/>comparing</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="211"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CDAFVR0<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="212"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CDAFVR1<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="213"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>FVREN<sp/>=<sp/>1;<sp/></highlight><highlight class="comment">//enable<sp/>ref</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="214"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(!FVRRDY);<sp/></highlight><highlight class="comment">//wait<sp/>until<sp/>its<sp/>ready</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="215"><highlight class="normal">}</highlight></codeline>
<codeline lineno="216"><highlight class="normal"></highlight></codeline>
<codeline lineno="217"><highlight class="normal"></highlight><highlight class="comment">//see<sp/>data<sp/>sheet<sp/>page<sp/>208<sp/>and<sp/>209</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="218"><highlight class="normal"></highlight></codeline>
<codeline lineno="219"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="220"><highlight class="comment"><sp/>*<sp/>used<sp/>to<sp/>compare<sp/>amps<sp/>signal</highlight></codeline>
<codeline lineno="221"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="222"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="powerspy_8h_1a990271cb1bf71a9ad908cf95daf1eb6b" kindref="member">initPWMTMR4</ref>()</highlight></codeline>
<codeline lineno="223"><highlight class="normal">{</highlight></codeline>
<codeline lineno="224"><highlight class="normal"></highlight></codeline>
<codeline lineno="225"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//see<sp/>data<sp/>sheet<sp/>page<sp/>119</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="226"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CCP1SEL<sp/>=<sp/>1;<sp/></highlight><highlight class="comment">//switch<sp/>output<sp/>from<sp/>RB3<sp/>to<sp/>RB0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="227"><highlight class="normal"></highlight></codeline>
<codeline lineno="228"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//1</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="229"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TRISBbits.TRISB0<sp/>=<sp/>1;<sp/></highlight><highlight class="comment">//disable<sp/>output<sp/>driver<sp/>for<sp/>RB0</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="230"><highlight class="normal"></highlight></codeline>
<codeline lineno="231"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//2</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="232"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>PR2<sp/>=<sp/>0xff;<sp/></highlight><highlight class="comment">//set<sp/>duty<sp/>cycle</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="233"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CCP1CON<sp/>=<sp/>0b00110000;<sp/></highlight><highlight class="comment">//lsbs<sp/>of<sp/>duty<sp/>cycle<sp/>for<sp/>10<sp/>bit<sp/>thingy,<sp/>data<sp/>sheet<sp/>page<sp/>226</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="234"><highlight class="normal"></highlight></codeline>
<codeline lineno="235"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//3</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="236"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CCP1CON<sp/>|=<sp/>0b00001100;</highlight></codeline>
<codeline lineno="237"><highlight class="normal"></highlight></codeline>
<codeline lineno="238"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//4</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="239"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//set<sp/>the<sp/>duty<sp/>(1023<sp/>=<sp/>100%,<sp/>0<sp/>=<sp/>0%)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="240"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//0x7f<sp/>+<sp/>1<sp/>+<sp/>1<sp/>==<sp/>511<sp/>=<sp/>50%</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="241"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//8<sp/>higher<sp/>bits</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="242"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CCPR1L<sp/>=<sp/>0x7f;<sp/></highlight><highlight class="comment">//Weil<sp/>besser....<sp/>kommen<sp/>auf<sp/>2.48V</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="243"><highlight class="normal"></highlight></codeline>
<codeline lineno="244"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//2<sp/>lower<sp/>bits</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="245"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DC1B0<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="246"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DC1B1<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="247"><highlight class="normal"></highlight></codeline>
<codeline lineno="248"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//5</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="249"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//see<sp/>data<sp/>sheet<sp/>page<sp/>227,<sp/>tmr<sp/>4<sp/>is<sp/>used</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="250"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C1TSEL0<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="251"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C1TSEL1<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="252"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TMR4IF<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="253"><highlight class="normal"></highlight></codeline>
<codeline lineno="254"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//see<sp/>data<sp/>sheet<sp/>page<sp/>189</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="255"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T4CKPS0<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="256"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>T4CKPS1<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="257"><highlight class="normal"></highlight></codeline>
<codeline lineno="258"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TMR4ON<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="259"><highlight class="normal"></highlight></codeline>
<codeline lineno="260"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//6</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="261"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//while<sp/>(!TMR4IF);<sp/>//wait<sp/>until<sp/>overflow<sp/>occured</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="262"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TMR4IF<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="263"><highlight class="normal"></highlight></codeline>
<codeline lineno="264"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TRISBbits.TRISB0<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="265"><highlight class="normal">}</highlight></codeline>
<codeline lineno="266"><highlight class="normal"></highlight></codeline>
<codeline lineno="267"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="268"><highlight class="comment"><sp/>*<sp/>see<sp/>data<sp/>sheet<sp/>page<sp/>164</highlight></codeline>
<codeline lineno="269"><highlight class="comment"><sp/>*<sp/>input<sp/>for<sp/>both<sp/>comparators</highlight></codeline>
<codeline lineno="270"><highlight class="comment"><sp/>*<sp/>|C1NCH1|C1NCH0|<sp/><sp/><sp/><sp/>SRC|ON<sp/>PIN|</highlight></codeline>
<codeline lineno="271"><highlight class="comment"><sp/>*<sp/>|-----:|-----:|------:|-----:|</highlight></codeline>
<codeline lineno="272"><highlight class="comment"><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/>0|<sp/><sp/><sp/><sp/><sp/>0|C12IN0-|<sp/><sp/><sp/>RA0|</highlight></codeline>
<codeline lineno="273"><highlight class="comment"><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/>0|<sp/><sp/><sp/><sp/><sp/>1|C12IN1-|<sp/><sp/><sp/>RA1|</highlight></codeline>
<codeline lineno="274"><highlight class="comment"><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/><sp/>0|C12IN2-|<sp/><sp/><sp/>RA2|</highlight></codeline>
<codeline lineno="275"><highlight class="comment"><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/><sp/>1|C12IN3-|<sp/><sp/><sp/>RA3|</highlight></codeline>
<codeline lineno="276"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="277"><highlight class="normal"></highlight></codeline>
<codeline lineno="278"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="279"><highlight class="comment"><sp/>*<sp/>Comparator<sp/>for<sp/>phase<sp/>measurement<sp/>of<sp/>the<sp/>Voltage</highlight></codeline>
<codeline lineno="280"><highlight class="comment"><sp/>*<sp/>uses<sp/>FVR<sp/>Buffer2</highlight></codeline>
<codeline lineno="281"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="282"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="powerspy_8h_1ae0b5b4551a6c8f5e5cd0bc1f8f07a8c6" kindref="member">initCOMP1</ref>()</highlight></codeline>
<codeline lineno="283"><highlight class="normal">{</highlight></codeline>
<codeline lineno="284"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//select<sp/>input<sp/>channel</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="285"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//see<sp/>data<sp/>sheet<sp/>page<sp/>164</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="286"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//C12IN1-</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="287"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C1NCH0<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="288"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C1NCH1<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="289"><highlight class="normal"></highlight></codeline>
<codeline lineno="290"><highlight class="normal"></highlight></codeline>
<codeline lineno="291"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/></highlight></codeline>
<codeline lineno="292"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|C1PCH1|C1PCH0|<sp/><sp/><sp/><sp/><sp/>SRC|ON<sp/>PIN|</highlight></codeline>
<codeline lineno="293"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|-----:|-----:|-------:|-----:|</highlight></codeline>
<codeline lineno="294"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/>0|<sp/><sp/><sp/><sp/><sp/>0|<sp/><sp/><sp/>C1IN+|<sp/><sp/><sp/>RA3|</highlight></codeline>
<codeline lineno="295"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/>0|<sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/><sp/>DAC|<sp/><sp/><sp/><sp/><sp/>-|</highlight></codeline>
<codeline lineno="296"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/><sp/>0|FVR<sp/>BUF2|<sp/><sp/><sp/><sp/><sp/>-|</highlight></codeline>
<codeline lineno="297"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/>C12IN+|<sp/><sp/><sp/>RA2|</highlight></codeline>
<codeline lineno="298"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="299"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//select<sp/>compare<sp/>source</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="300"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//see<sp/>data<sp/>sheet<sp/>page<sp/>164</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="301"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//FVR<sp/>BUF2</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="302"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C1PCH0<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="303"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C1PCH1<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="304"><highlight class="normal"></highlight></codeline>
<codeline lineno="305"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//turn<sp/>comp<sp/>1<sp/>on</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="306"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C1INTP<sp/>=<sp/>1;<sp/></highlight><highlight class="comment">//falling<sp/>edge,<sp/>since<sp/>the<sp/>edges<sp/>are<sp/>reversed</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="307"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C1IE<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="308"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C1IF<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="309"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C1ON<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="310"><highlight class="normal">}</highlight></codeline>
<codeline lineno="311"><highlight class="normal"></highlight></codeline>
<codeline lineno="312"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="313"><highlight class="comment"><sp/>*<sp/>Comparator<sp/>for<sp/>phase<sp/>measurement<sp/>of<sp/>the<sp/>Amps</highlight></codeline>
<codeline lineno="314"><highlight class="comment"><sp/>*<sp/>uses<sp/>Voltage<sp/>reference<sp/>generated<sp/>by<sp/>the<sp/>pwm</highlight></codeline>
<codeline lineno="315"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="316"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="powerspy_8h_1acc739909b6a4e417b9af88738e662987" kindref="member">initCOMP2</ref>()</highlight></codeline>
<codeline lineno="317"><highlight class="normal">{</highlight></codeline>
<codeline lineno="318"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//select<sp/>input<sp/>channel</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="319"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//see<sp/>data<sp/>sheet<sp/>page<sp/>165</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="320"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//C12IN0-</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="321"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C2NCH0<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="322"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C2NCH1<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="323"><highlight class="normal"></highlight></codeline>
<codeline lineno="324"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*<sp/></highlight></codeline>
<codeline lineno="325"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|C2PCH1|C2PCH0|<sp/><sp/><sp/><sp/><sp/>SRC|ON<sp/>PIN|</highlight></codeline>
<codeline lineno="326"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|-----:|-----:|-------:|-----:|</highlight></codeline>
<codeline lineno="327"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/>0|<sp/><sp/><sp/><sp/><sp/>0|<sp/><sp/>C12IN+|<sp/><sp/><sp/>RA2|</highlight></codeline>
<codeline lineno="328"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/>0|<sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/><sp/>DAC|<sp/><sp/><sp/><sp/><sp/>-|</highlight></codeline>
<codeline lineno="329"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/><sp/>0|FVR<sp/>BUF2|<sp/><sp/><sp/><sp/><sp/>-|</highlight></codeline>
<codeline lineno="330"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|<sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/><sp/>1|<sp/><sp/><sp/><sp/><sp/>VSS|<sp/><sp/><sp/><sp/><sp/>-|</highlight></codeline>
<codeline lineno="331"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="332"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//select<sp/>compare<sp/>source</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="333"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//see<sp/>data<sp/>sheet<sp/>page<sp/>165</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="334"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//C12IN+</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="335"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C2PCH0<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="336"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C2PCH1<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="337"><highlight class="normal"></highlight></codeline>
<codeline lineno="338"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//turn<sp/>comp<sp/>2<sp/>on</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="339"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C2INTP<sp/>=<sp/>1;<sp/></highlight><highlight class="comment">//falling<sp/>edge,<sp/>since<sp/>the<sp/>edges<sp/>are<sp/>reversed,<sp/>actually<sp/>it<sp/>doesn&apos;t<sp/>matter,<sp/>since<sp/>we<sp/>only<sp/>need<sp/>to<sp/>use<sp/>the<sp/>same<sp/>edges<sp/>on<sp/>both<sp/>signals</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="340"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C2IE<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="341"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C2IF<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="342"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C2ON<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="343"><highlight class="normal">}</highlight></codeline>
<codeline lineno="344"><highlight class="normal"></highlight></codeline>
<codeline lineno="345"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="346"><highlight class="comment"><sp/>*<sp/>Init<sp/>the<sp/>USART<sp/>module<sp/>for<sp/>communication<sp/>with<sp/>the<sp/>bt<sp/>module</highlight></codeline>
<codeline lineno="347"><highlight class="comment"><sp/>*<sp/>the<sp/>bauderate<sp/>is<sp/>9600</highlight></codeline>
<codeline lineno="348"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="349"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="powerspy_8h_1a1937a1a69f27dd9e91c099e4429731be" kindref="member">initBT</ref>()</highlight></codeline>
<codeline lineno="350"><highlight class="normal">{</highlight></codeline>
<codeline lineno="351"><highlight class="normal"></highlight></codeline>
<codeline lineno="352"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//select<sp/>output<sp/>pin</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="353"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>RXDTSEL<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="354"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TXCKSEL<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="355"><highlight class="normal"></highlight></codeline>
<codeline lineno="356"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//Configure<sp/>TX</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="357"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TXEN<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="358"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SYNC<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="359"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SPEN<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="360"><highlight class="normal"></highlight></codeline>
<codeline lineno="361"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//Configure<sp/>RX</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="362"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CREN<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="363"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SYNC<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="364"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SPEN<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="365"><highlight class="normal"></highlight></codeline>
<codeline lineno="366"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//Set<sp/>Baudrate<sp/>for<sp/>BT<sp/>Module<sp/>to<sp/>9600</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="367"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>BRGH<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="368"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>BRG16<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="369"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SPBRG<sp/>=<sp/>51;<sp/></highlight><highlight class="comment">//Datasheet<sp/>Page<sp/>299</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="370"><highlight class="normal"></highlight></codeline>
<codeline lineno="371"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(RCIF)<sp/>{</highlight></codeline>
<codeline lineno="372"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>RCREG;</highlight></codeline>
<codeline lineno="373"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="374"><highlight class="normal"></highlight></codeline>
<codeline lineno="375"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>RCIE<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="376"><highlight class="normal">}</highlight></codeline>
<codeline lineno="377"><highlight class="normal"></highlight></codeline>
<codeline lineno="378"><highlight class="normal"></highlight><highlight class="comment">/******************************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="379"><highlight class="normal"></highlight><highlight class="comment">/*core<sp/>methods*****************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="380"><highlight class="normal"></highlight><highlight class="comment">/******************************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="381"><highlight class="normal"></highlight></codeline>
<codeline lineno="382"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="383"><highlight class="comment"><sp/>*<sp/>give<sp/>the<sp/>desired<sp/>channel<sp/>&lt;n&gt;</highlight></codeline>
<codeline lineno="384"><highlight class="comment"><sp/>*<sp/>where<sp/>n<sp/>ranges<sp/>from<sp/>0<sp/>to<sp/>11</highlight></codeline>
<codeline lineno="385"><highlight class="comment"><sp/>*<sp/></highlight></codeline>
<codeline lineno="386"><highlight class="comment"><sp/>*<sp/>src:<sp/>the<sp/>desired<sp/>channel</highlight></codeline>
<codeline lineno="387"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="388"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="powerspy_8h_1a4fbdf44d733d619a014a5a6f2315700d" kindref="member">adc</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>int8_t<sp/>src)</highlight></codeline>
<codeline lineno="389"><highlight class="normal">{</highlight></codeline>
<codeline lineno="390"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="391"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>src<sp/>is<sp/>an<sp/>char<sp/>ranging<sp/>from<sp/>0<sp/>to<sp/>11</highlight></codeline>
<codeline lineno="392"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/></highlight></codeline>
<codeline lineno="393"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|SOURCE|REGISTER_PIN|EXTERNAL<sp/>PIN/18|</highlight></codeline>
<codeline lineno="394"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|------|------------|---------------|</highlight></codeline>
<codeline lineno="395"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|AN0<sp/><sp/><sp/>|RA0<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|17<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|</highlight></codeline>
<codeline lineno="396"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|AN1<sp/><sp/><sp/>|RA1<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|18<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|</highlight></codeline>
<codeline lineno="397"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|AN2<sp/><sp/><sp/>|RA2<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/>1<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|</highlight></codeline>
<codeline lineno="398"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|AN3<sp/><sp/><sp/>|RA3<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/>2<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|</highlight></codeline>
<codeline lineno="399"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|AN4<sp/><sp/><sp/>|RA4<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/>3<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|</highlight></codeline>
<codeline lineno="400"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|AN5<sp/><sp/><sp/>|RB6<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|12<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|</highlight></codeline>
<codeline lineno="401"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|AN6<sp/><sp/><sp/>|RB7<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|13<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|</highlight></codeline>
<codeline lineno="402"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|AN7<sp/><sp/><sp/>|RB5<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|11<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|</highlight></codeline>
<codeline lineno="403"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|AN8<sp/><sp/><sp/>|RB4<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|10<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|</highlight></codeline>
<codeline lineno="404"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|AN9<sp/><sp/><sp/>|RB3<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/>9<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|</highlight></codeline>
<codeline lineno="405"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|AN10<sp/><sp/>|RB2<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/>8<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|</highlight></codeline>
<codeline lineno="406"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>|AN11<sp/><sp/>|RB1<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|<sp/>7<sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>|</highlight></codeline>
<codeline lineno="407"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>select<sp/>the<sp/>channel</highlight></codeline>
<codeline lineno="408"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>since<sp/>the<sp/>bit<sp/>combination<sp/>is<sp/>sorted<sp/>we<sp/>can<sp/>do<sp/>this:</highlight></codeline>
<codeline lineno="409"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="410"><highlight class="normal"></highlight></codeline>
<codeline lineno="411"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CHS0<sp/>=<sp/>(bit)<sp/>(src<sp/>&gt;&gt;<sp/>0)<sp/>&amp;<sp/>0x01;</highlight></codeline>
<codeline lineno="412"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CHS1<sp/>=<sp/>(bit)<sp/>(src<sp/>&gt;&gt;<sp/>1)<sp/>&amp;<sp/>0x01;</highlight></codeline>
<codeline lineno="413"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CHS2<sp/>=<sp/>(bit)<sp/>(src<sp/>&gt;&gt;<sp/>2)<sp/>&amp;<sp/>0x01;</highlight></codeline>
<codeline lineno="414"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CHS3<sp/>=<sp/>(bit)<sp/>(src<sp/>&gt;&gt;<sp/>3)<sp/>&amp;<sp/>0x01;</highlight></codeline>
<codeline lineno="415"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>CHS4<sp/>=<sp/>(bit)<sp/>(src<sp/>&gt;&gt;<sp/>4)<sp/>&amp;<sp/>0x01;</highlight></codeline>
<codeline lineno="416"><highlight class="normal"></highlight></codeline>
<codeline lineno="417"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>__delay_us(5);</highlight></codeline>
<codeline lineno="418"><highlight class="normal"></highlight></codeline>
<codeline lineno="419"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//convert</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="420"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GO_nDONE<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="421"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(GO_nDONE);</highlight></codeline>
<codeline lineno="422"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//the<sp/>result<sp/>is<sp/>in<sp/>ADRESH<sp/>and<sp/>ADRESL</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="423"><highlight class="normal">}</highlight></codeline>
<codeline lineno="424"><highlight class="normal"></highlight></codeline>
<codeline lineno="425"><highlight class="normal"></highlight><highlight class="comment">/******************************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="426"><highlight class="normal"></highlight><highlight class="comment">/*convenient<sp/>methods***********************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="427"><highlight class="normal"></highlight><highlight class="comment">/******************************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="428"><highlight class="normal"></highlight></codeline>
<codeline lineno="429"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="430"><highlight class="comment"><sp/>*<sp/>unused<sp/>as<sp/>of<sp/>now,<sp/>will<sp/>probably<sp/>not<sp/>be<sp/>implemented</highlight></codeline>
<codeline lineno="431"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="432"><highlight class="normal">uint8_t<sp/><ref refid="powerspy_8h_1abad6c151b93f88becacb00a6f3727416" kindref="member">readVoltage</ref>()</highlight></codeline>
<codeline lineno="433"><highlight class="normal">{</highlight></codeline>
<codeline lineno="434"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>230;</highlight></codeline>
<codeline lineno="435"><highlight class="normal">}</highlight></codeline>
<codeline lineno="436"><highlight class="normal"></highlight></codeline>
<codeline lineno="437"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="438"><highlight class="comment"><sp/>*<sp/>returns<sp/>the<sp/>current<sp/>in<sp/>amps<sp/>as<sp/>float</highlight></codeline>
<codeline lineno="439"><highlight class="comment"><sp/>*<sp/>since<sp/>the<sp/>voltage<sp/>is<sp/>regulated,<sp/>we<sp/>can<sp/>just</highlight></codeline>
<codeline lineno="440"><highlight class="comment"><sp/>*<sp/>measure<sp/>at<sp/>any<sp/>time</highlight></codeline>
<codeline lineno="441"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="442"><highlight class="normal">int24_t<sp/><ref refid="powerspy_8h_1a69737966a3174628c469a37d6db002a7" kindref="member">readCurrent</ref>()</highlight></codeline>
<codeline lineno="443"><highlight class="normal">{</highlight></codeline>
<codeline lineno="444"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="445"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>function<sp/>for<sp/>current:<sp/>curr(volt)=5*volt-12.5</highlight></codeline>
<codeline lineno="446"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>note:<sp/>this<sp/>only<sp/>applies,<sp/>when<sp/>the<sp/>processor<sp/>is<sp/>powered<sp/>with<sp/>5Volts</highlight></codeline>
<codeline lineno="447"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>to<sp/>convert<sp/>from<sp/>unitless<sp/>to<sp/>0-5V<sp/>we<sp/>need<sp/>to<sp/>multiply<sp/>ADRESH<sp/>with<sp/>5</highlight></codeline>
<codeline lineno="448"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*<sp/>and<sp/>divide<sp/>it<sp/>thru<sp/>256<sp/>since<sp/>we<sp/>only<sp/>use<sp/>the<sp/>8<sp/>highest<sp/>order<sp/>bits</highlight></codeline>
<codeline lineno="449"><highlight class="comment"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="450"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ADFM<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="451"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1a4fbdf44d733d619a014a5a6f2315700d" kindref="member">adc</ref>(7);</highlight></codeline>
<codeline lineno="452"><highlight class="normal"></highlight></codeline>
<codeline lineno="453"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//return<sp/>(ADRES<sp/>*<sp/>5000<sp/>/<sp/>1024<sp/>+<sp/>i_u_diode_offs)<sp/>*<sp/>5.0<sp/>+<sp/>i_u_offs;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="454"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//measured<sp/>val<sp/>*<sp/>value<sp/>range<sp/>/<sp/>scale<sp/>+<sp/>offset</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="455"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//return<sp/>((ADRES<sp/>+<sp/>i_u_diode_offs)<sp/>*<sp/>5000)<sp/>/<sp/>1024<sp/>+<sp/>i_u_offs;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="456"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>(1000<sp/>*<sp/>(5<sp/>*<sp/>(ADRES<sp/>+<sp/>i_u_diode_offs)<sp/>+<sp/>i_u_offs))<sp/>/<sp/>1024;</highlight></codeline>
<codeline lineno="457"><highlight class="normal">}</highlight></codeline>
<codeline lineno="458"><highlight class="normal"></highlight></codeline>
<codeline lineno="459"><highlight class="normal">uint16_t<sp/><ref refid="powerspy_8h_1aac2b18361514a260b77f367bb12fa77a" kindref="member">readVdd</ref>()</highlight></codeline>
<codeline lineno="460"><highlight class="normal">{</highlight></codeline>
<codeline lineno="461"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>ADFM<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="462"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1a4fbdf44d733d619a014a5a6f2315700d" kindref="member">adc</ref>(0b00011111);<sp/></highlight><highlight class="comment">//fvr<sp/>buffer<sp/>output</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="463"><highlight class="normal"></highlight></codeline>
<codeline lineno="464"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//return<sp/>(1024.0<sp/>/<sp/>ADRES)<sp/>*<sp/>1.024;</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="465"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>flt_vdd<sp/>=<sp/>(1024.0/<sp/>ADRES)<sp/>*<sp/>1.024</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="466"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//<sp/>int1000<sp/>=<sp/>(1024<sp/>*<sp/>1000)<sp/>/<sp/>ADRES</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="467"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//return<sp/>(1024000)<sp/>/<sp/>ADRES</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="468"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>ADRES&lt;&lt;2;</highlight></codeline>
<codeline lineno="469"><highlight class="normal">}</highlight></codeline>
<codeline lineno="470"><highlight class="normal"></highlight></codeline>
<codeline lineno="471"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="472"><highlight class="comment"><sp/>*<sp/>shift<sp/>a<sp/>char<sp/>of<sp/>data<sp/>out<sp/>of<sp/>the<sp/>pic</highlight></codeline>
<codeline lineno="473"><highlight class="comment"><sp/>*<sp/>the<sp/>latch<sp/>is<sp/>not<sp/>handled</highlight></codeline>
<codeline lineno="474"><highlight class="comment"><sp/>*<sp/>datapin:<sp/>DISPLAY_DATA</highlight></codeline>
<codeline lineno="475"><highlight class="comment"><sp/>*<sp/>clockpin:<sp/>DISPLAY_CLK</highlight></codeline>
<codeline lineno="476"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="477"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="powerspy_8h_1a0f26c0064b568a85c7be468e2235a2f4" kindref="member">so</ref>(</highlight><highlight class="keyword">const</highlight><highlight class="normal"><sp/>uint8_t<sp/>data)</highlight></codeline>
<codeline lineno="478"><highlight class="normal">{</highlight></codeline>
<codeline lineno="479"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>uint8_t<sp/>c;</highlight></codeline>
<codeline lineno="480"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(c<sp/>=<sp/>0;<sp/>c<sp/>&lt;<sp/>CHAR_BIT;<sp/>c++)<sp/>{</highlight></codeline>
<codeline lineno="481"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DISPLAY_DATA<sp/>=<sp/>(data<sp/>&gt;&gt;<sp/>c)<sp/>&amp;<sp/>0x01;</highlight></codeline>
<codeline lineno="482"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SHIFT_DELAY</highlight></codeline>
<codeline lineno="483"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SHIFT_DELAY</highlight></codeline>
<codeline lineno="484"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SHIFT_DELAY</highlight></codeline>
<codeline lineno="485"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SHIFT_DELAY</highlight></codeline>
<codeline lineno="486"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DISPLAY_CLK<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="487"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SHIFT_DELAY</highlight></codeline>
<codeline lineno="488"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SHIFT_DELAY</highlight></codeline>
<codeline lineno="489"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SHIFT_DELAY</highlight></codeline>
<codeline lineno="490"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>SHIFT_DELAY</highlight></codeline>
<codeline lineno="491"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DISPLAY_CLK<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="492"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="493"><highlight class="normal">}</highlight></codeline>
<codeline lineno="494"><highlight class="normal"></highlight></codeline>
<codeline lineno="495"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="496"><highlight class="comment"><sp/>*<sp/>well,<sp/>clears<sp/>the<sp/>display</highlight></codeline>
<codeline lineno="497"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="498"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="powerspy_8h_1a8f35dad172390f2c99bf58f71c4fe2fb" kindref="member">clearDisplay</ref>(int8_t<sp/>leng)</highlight></codeline>
<codeline lineno="499"><highlight class="normal">{</highlight></codeline>
<codeline lineno="500"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(;<sp/>leng<sp/>&gt;=<sp/>0;<sp/>leng--)</highlight></codeline>
<codeline lineno="501"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1a0f26c0064b568a85c7be468e2235a2f4" kindref="member">so</ref>(0xff);</highlight></codeline>
<codeline lineno="502"><highlight class="normal">}</highlight></codeline>
<codeline lineno="503"><highlight class="normal"></highlight></codeline>
<codeline lineno="504"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="505"><highlight class="comment"><sp/>*<sp/>sends<sp/>one<sp/>byte<sp/>of<sp/>colour<sp/>information<sp/>to<sp/>the<sp/>led</highlight></codeline>
<codeline lineno="506"><highlight class="comment"><sp/>*<sp/>-<sp/>highest<sp/>bit<sp/>first</highlight></codeline>
<codeline lineno="507"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="508"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="powerspy_8h_1acc6c625c563afa5f78048472d71d1b85" kindref="member">sendColour</ref>(uint8_t<sp/>c)</highlight></codeline>
<codeline lineno="509"><highlight class="normal">{</highlight></codeline>
<codeline lineno="510"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>&amp;<sp/>0b10000000)<sp/>LED_HIGHBIT</highlight></codeline>
<codeline lineno="511"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>LED_LOWBIT;</highlight></codeline>
<codeline lineno="512"><highlight class="normal"></highlight></codeline>
<codeline lineno="513"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>&amp;<sp/>0b01000000)<sp/>LED_HIGHBIT</highlight></codeline>
<codeline lineno="514"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>LED_LOWBIT;</highlight></codeline>
<codeline lineno="515"><highlight class="normal"></highlight></codeline>
<codeline lineno="516"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>&amp;<sp/>0b00100000)<sp/>LED_HIGHBIT</highlight></codeline>
<codeline lineno="517"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>LED_LOWBIT;</highlight></codeline>
<codeline lineno="518"><highlight class="normal"></highlight></codeline>
<codeline lineno="519"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>&amp;<sp/>0b00010000)<sp/>LED_HIGHBIT</highlight></codeline>
<codeline lineno="520"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>LED_LOWBIT;</highlight></codeline>
<codeline lineno="521"><highlight class="normal"></highlight></codeline>
<codeline lineno="522"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>&amp;<sp/>0b00001000)<sp/>LED_HIGHBIT</highlight></codeline>
<codeline lineno="523"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>LED_LOWBIT;</highlight></codeline>
<codeline lineno="524"><highlight class="normal"></highlight></codeline>
<codeline lineno="525"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>&amp;<sp/>0b00000100)<sp/>LED_HIGHBIT</highlight></codeline>
<codeline lineno="526"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>LED_LOWBIT;</highlight></codeline>
<codeline lineno="527"><highlight class="normal"></highlight></codeline>
<codeline lineno="528"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>&amp;<sp/>0b00000010)<sp/>LED_HIGHBIT</highlight></codeline>
<codeline lineno="529"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>LED_LOWBIT;</highlight></codeline>
<codeline lineno="530"><highlight class="normal"></highlight></codeline>
<codeline lineno="531"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(c<sp/>&amp;<sp/>0b00000001)<sp/>LED_HIGHBIT</highlight></codeline>
<codeline lineno="532"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>LED_LOWBIT;</highlight></codeline>
<codeline lineno="533"><highlight class="normal">}</highlight></codeline>
<codeline lineno="534"><highlight class="normal"></highlight></codeline>
<codeline lineno="535"><highlight class="normal"></highlight><highlight class="comment">/******************************************************************************</highlight></codeline>
<codeline lineno="536"><highlight class="comment"><sp/>*main<sp/>program*****************************************************************</highlight></codeline>
<codeline lineno="537"><highlight class="comment"><sp/>******************************************************************************/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="538"><highlight class="normal"></highlight></codeline>
<codeline lineno="539"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="540"><highlight class="comment"><sp/>*<sp/>compute<sp/>the<sp/>time<sp/>difference,<sp/>is<sp/>only<sp/>invoked<sp/>by<sp/>the<sp/>interrupt<sp/>service<sp/>routine</highlight></codeline>
<codeline lineno="541"><highlight class="comment"><sp/>*<sp/>the<sp/>flag<sp/>byte<sp/>should<sp/>be<sp/>cleared<sp/>afterwards</highlight></codeline>
<codeline lineno="542"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="543"><highlight class="normal">uint16_t<sp/><ref refid="powerspy_8h_1aa7e5cea063dbb34802dda31333eaef58" kindref="member">deltaT</ref>(uint16_t<sp/>tm_low,<sp/>uint16_t<sp/>tm_high)</highlight></codeline>
<codeline lineno="544"><highlight class="normal">{</highlight></codeline>
<codeline lineno="545"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(tm_low<sp/>&lt;<sp/>tm_high)<sp/></highlight><highlight class="comment">//no<sp/>overflow<sp/>bc<sp/>obv</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="546"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>tm_high<sp/>-<sp/>tm_low;</highlight></codeline>
<codeline lineno="547"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="comment">//no<sp/>overflow<sp/>bc<sp/>now<sp/>tm_low<sp/>&gt;=<sp/>tm_high</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="548"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0xffff<sp/>-<sp/>tm_low<sp/>+<sp/>tm_high;</highlight></codeline>
<codeline lineno="549"><highlight class="normal">}</highlight></codeline>
<codeline lineno="550"><highlight class="normal"></highlight></codeline>
<codeline lineno="551"><highlight class="normal">int8_t<sp/><ref refid="powerspy_8h_1a49011b67fdd3b5aa99c5305c4def8688" kindref="member">sin_</ref>(int8_t<sp/>z)</highlight></codeline>
<codeline lineno="552"><highlight class="normal">{</highlight></codeline>
<codeline lineno="553"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>eeprom_read(z);</highlight></codeline>
<codeline lineno="554"><highlight class="normal">}</highlight></codeline>
<codeline lineno="555"><highlight class="normal"></highlight></codeline>
<codeline lineno="556"><highlight class="normal"></highlight><highlight class="comment">//z<sp/>is<sp/>in<sp/>the<sp/>range<sp/>of<sp/>0<sp/>...<sp/>100</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="557"><highlight class="normal"></highlight></codeline>
<codeline lineno="558"><highlight class="normal">int8_t<sp/><ref refid="powerspy_8h_1ad09cda1044ebc5675a9b462e5a11978a" kindref="member">sin</ref>(int16_t<sp/>z)</highlight></codeline>
<codeline lineno="559"><highlight class="normal">{</highlight></codeline>
<codeline lineno="560"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//us<sp/>/=<sp/>50;<sp/>//convert<sp/>from<sp/>us<sp/>to<sp/>winkel<sp/>grad<sp/>(not<sp/>deg)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="561"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int16_t<sp/>buff;</highlight></codeline>
<codeline lineno="562"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(z<sp/>&gt;<sp/>FULL_ROTATION)</highlight></codeline>
<codeline lineno="563"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>z<sp/>-=<sp/>FULL_ROTATION;</highlight></codeline>
<codeline lineno="564"><highlight class="normal"></highlight></codeline>
<codeline lineno="565"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(z<sp/>&gt;<sp/>(HALF_ROTATION)<sp/>+<sp/>QUARTER_ROTATION)<sp/>{<sp/></highlight><highlight class="comment">//4th<sp/>quad</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="566"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buff<sp/>=<sp/>FULL_ROTATION;</highlight></codeline>
<codeline lineno="567"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buff<sp/>-=<sp/>z;</highlight></codeline>
<codeline lineno="568"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-<ref refid="powerspy_8h_1a49011b67fdd3b5aa99c5305c4def8688" kindref="member">sin_</ref>((int8_t)<sp/>buff);</highlight></codeline>
<codeline lineno="569"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="570"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(z<sp/>&gt;<sp/>HALF_ROTATION)<sp/>{</highlight><highlight class="comment">//3rd<sp/>quad</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="571"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buff<sp/>=<sp/>z;</highlight></codeline>
<codeline lineno="572"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buff<sp/>-=<sp/>HALF_ROTATION;</highlight></codeline>
<codeline lineno="573"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>-<ref refid="powerspy_8h_1a49011b67fdd3b5aa99c5305c4def8688" kindref="member">sin_</ref>((int8_t)<sp/>buff);</highlight></codeline>
<codeline lineno="574"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="575"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(z<sp/>&gt;<sp/>QUARTER_ROTATION)<sp/>{</highlight><highlight class="comment">//2nd<sp/>quad</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="576"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buff<sp/>=<sp/>HALF_ROTATION;</highlight></codeline>
<codeline lineno="577"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buff<sp/>-=<sp/>z;</highlight></codeline>
<codeline lineno="578"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="powerspy_8h_1a49011b67fdd3b5aa99c5305c4def8688" kindref="member">sin_</ref>((int8_t)<sp/>buff);</highlight></codeline>
<codeline lineno="579"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="580"><highlight class="normal"></highlight></codeline>
<codeline lineno="581"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//1st<sp/>quad</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="582"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="powerspy_8h_1a49011b67fdd3b5aa99c5305c4def8688" kindref="member">sin_</ref>((int8_t)<sp/>z);</highlight></codeline>
<codeline lineno="583"><highlight class="normal">}</highlight></codeline>
<codeline lineno="584"><highlight class="normal"></highlight></codeline>
<codeline lineno="585"><highlight class="normal">int8_t<sp/><ref refid="powerspy_8h_1ab00c5a1c9dde13d399d08c6a19f89bcc" kindref="member">cos</ref>(int16_t<sp/>us)</highlight></codeline>
<codeline lineno="586"><highlight class="normal">{</highlight></codeline>
<codeline lineno="587"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/><ref refid="powerspy_8h_1ad09cda1044ebc5675a9b462e5a11978a" kindref="member">sin</ref>(QUARTER_ROTATION<sp/>+<sp/>us);</highlight></codeline>
<codeline lineno="588"><highlight class="normal">}</highlight></codeline>
<codeline lineno="589"><highlight class="normal"></highlight></codeline>
<codeline lineno="590"><highlight class="normal">uint8_t<sp/><ref refid="powerspy_8h_1ab6dcfeb080c4fc27b28b9ac99b9a8aa8" kindref="member">ledReset</ref>()</highlight></codeline>
<codeline lineno="591"><highlight class="normal">{</highlight></codeline>
<codeline lineno="592"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//because<sp/>we<sp/>have<sp/>a<sp/>prescale<sp/>of<sp/>1:2<sp/>we<sp/>can<sp/>use<sp/>only<sp/>half<sp/>of<sp/>the<sp/>required<sp/>step<sp/>count</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="593"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(led_rest<sp/>&lt;<sp/>getTime())<sp/>{</highlight></codeline>
<codeline lineno="594"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(getTime()<sp/>-<sp/>led_rest<sp/>&gt;<sp/>200)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="595"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="596"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(led_rest<sp/>&gt;<sp/>getTime())<sp/>{</highlight></codeline>
<codeline lineno="597"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(0xffff<sp/>-<sp/>led_rest<sp/>+<sp/>getTime()<sp/>&gt;<sp/>200)<sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>1;</highlight></codeline>
<codeline lineno="598"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="599"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="600"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">return</highlight><highlight class="normal"><sp/>0;</highlight></codeline>
<codeline lineno="601"><highlight class="normal">}</highlight></codeline>
<codeline lineno="602"><highlight class="normal"></highlight></codeline>
<codeline lineno="603"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="604"><highlight class="comment"><sp/>*<sp/>reprograms<sp/>the<sp/>led<sp/>to<sp/>the<sp/>desired<sp/>colour</highlight></codeline>
<codeline lineno="605"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="606"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="powerspy_8h_1aa76a726af97e61c931dc5c48da533842" kindref="member">setLED</ref>(uint8_t<sp/>g,<sp/>uint8_t<sp/>r,<sp/>uint8_t<sp/>b)</highlight></codeline>
<codeline lineno="607"><highlight class="normal">{</highlight></codeline>
<codeline lineno="608"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1acc6c625c563afa5f78048472d71d1b85" kindref="member">sendColour</ref>(g);</highlight></codeline>
<codeline lineno="609"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1acc6c625c563afa5f78048472d71d1b85" kindref="member">sendColour</ref>(r);</highlight></codeline>
<codeline lineno="610"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1acc6c625c563afa5f78048472d71d1b85" kindref="member">sendColour</ref>(b);</highlight></codeline>
<codeline lineno="611"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>led_rest<sp/>=<sp/>getTime();</highlight></codeline>
<codeline lineno="612"><highlight class="normal">}</highlight></codeline>
<codeline lineno="613"><highlight class="normal"></highlight></codeline>
<codeline lineno="614"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="powerspy_8h_1ae516f2ff48d3fcf8c5fd638c92878e66" kindref="member">setUnit</ref>(uint24_t<sp/>u)</highlight></codeline>
<codeline lineno="615"><highlight class="normal">{</highlight></codeline>
<codeline lineno="616"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1a0f26c0064b568a85c7be468e2235a2f4" kindref="member">so</ref>(u<sp/>&gt;&gt;<sp/>16<sp/>&amp;<sp/>0xff);</highlight></codeline>
<codeline lineno="617"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1a0f26c0064b568a85c7be468e2235a2f4" kindref="member">so</ref>(u<sp/>&gt;&gt;<sp/>8<sp/>&amp;<sp/>0xff);</highlight></codeline>
<codeline lineno="618"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1a0f26c0064b568a85c7be468e2235a2f4" kindref="member">so</ref>(u<sp/>&amp;<sp/>0xff);</highlight></codeline>
<codeline lineno="619"><highlight class="normal">}</highlight></codeline>
<codeline lineno="620"><highlight class="normal"></highlight></codeline>
<codeline lineno="621"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/><ref refid="powerspy_8h_1ac2e00b08576dfbc9457a38a93daf5cf7" kindref="member">setVal</ref>(int16_t<sp/>v)</highlight></codeline>
<codeline lineno="622"><highlight class="normal">{</highlight></codeline>
<codeline lineno="623"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int8_t<sp/>i;</highlight></codeline>
<codeline lineno="624"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">for</highlight><highlight class="normal"><sp/>(i<sp/>=<sp/>0;<sp/>i<sp/>&lt;<sp/>SHIFT_REG_LEN<sp/>-<sp/>3;<sp/>i++)<sp/>{</highlight></codeline>
<codeline lineno="625"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1a0f26c0064b568a85c7be468e2235a2f4" kindref="member">so</ref>(get_shift_byte[v<sp/>%<sp/>10]);</highlight></codeline>
<codeline lineno="626"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>v<sp/>/=<sp/>10;</highlight></codeline>
<codeline lineno="627"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="628"><highlight class="normal">}</highlight></codeline>
<codeline lineno="629"><highlight class="normal"></highlight></codeline>
<codeline lineno="630"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>__interrupt<sp/><ref refid="powerspy_8h_1a085e1179e1a03b59da3a42398e8f86f5" kindref="member">ISR</ref>()</highlight></codeline>
<codeline lineno="631"><highlight class="normal">{</highlight></codeline>
<codeline lineno="632"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//usart<sp/>data<sp/>received</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="633"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(RCIE<sp/>&amp;&amp;<sp/>RCIF)<sp/>{</highlight></codeline>
<codeline lineno="634"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>receive_buff[buffpos]<sp/>=<sp/>RCREG;</highlight></codeline>
<codeline lineno="635"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buffpos++;</highlight></codeline>
<codeline lineno="636"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>buffpos<sp/>%=<sp/>RECEIVEBUFF_SIZE;</highlight></codeline>
<codeline lineno="637"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>RCIF<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="638"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="639"><highlight class="normal"></highlight></codeline>
<codeline lineno="640"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//in<sp/>us</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="641"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(TMR1IE<sp/>&amp;&amp;<sp/>TMR1IF)<sp/>{</highlight></codeline>
<codeline lineno="642"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TMR1IF<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="643"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="644"><highlight class="normal"></highlight></codeline>
<codeline lineno="645"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//volts</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="646"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(C1IE<sp/>&amp;&amp;<sp/>C1IF)<sp/>{</highlight></codeline>
<codeline lineno="647"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!(flag<sp/>&amp;<sp/>0x01))<sp/>{<sp/></highlight><highlight class="comment">//is<sp/>volt<sp/>not<sp/>set</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="648"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>volt_time<sp/>=<sp/>getTime();</highlight></codeline>
<codeline lineno="649"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(flag<sp/>&amp;<sp/>0x02)<sp/></highlight><highlight class="comment">//is<sp/>current<sp/>set</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="650"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>flag<sp/>|=<sp/>0x08;</highlight></codeline>
<codeline lineno="651"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>flag<sp/>|=<sp/>0x01;</highlight></codeline>
<codeline lineno="652"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="653"><highlight class="normal"></highlight></codeline>
<codeline lineno="654"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C1IF<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="655"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="656"><highlight class="normal"></highlight></codeline>
<codeline lineno="657"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//amps</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="658"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(C2IE<sp/>&amp;&amp;<sp/>C2IF)<sp/>{</highlight></codeline>
<codeline lineno="659"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!(flag<sp/>&amp;<sp/>0x02))<sp/>{<sp/></highlight><highlight class="comment">//is<sp/>current<sp/>not<sp/>set</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="660"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>curr_time<sp/>=<sp/>getTime();</highlight></codeline>
<codeline lineno="661"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(flag<sp/>&amp;<sp/>0x01)<sp/></highlight><highlight class="comment">//is<sp/>volt<sp/>set</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="662"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>flag<sp/>|=<sp/>0x04;</highlight></codeline>
<codeline lineno="663"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>flag<sp/>|=<sp/>0x02;</highlight></codeline>
<codeline lineno="664"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="665"><highlight class="normal"></highlight></codeline>
<codeline lineno="666"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>C2IF<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="667"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="668"><highlight class="normal"></highlight></codeline>
<codeline lineno="669"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(TMR2IE<sp/>&amp;&amp;<sp/>TMR2IF)<sp/>{</highlight></codeline>
<codeline lineno="670"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>TMR2IF<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="671"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="672"><highlight class="normal">}</highlight></codeline>
<codeline lineno="673"><highlight class="normal"></highlight></codeline>
<codeline lineno="674"><highlight class="normal"></highlight><highlight class="comment">/*</highlight></codeline>
<codeline lineno="675"><highlight class="comment"><sp/>*<sp/>main<sp/>method,<sp/>guess<sp/>what<sp/>it<sp/>does!</highlight></codeline>
<codeline lineno="676"><highlight class="comment"><sp/>*/</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="677"><highlight class="normal"></highlight><highlight class="keywordtype">void</highlight><highlight class="normal"><sp/>main()</highlight></codeline>
<codeline lineno="678"><highlight class="normal">{</highlight></codeline>
<codeline lineno="679"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordtype">int</highlight><highlight class="normal"><sp/>bmode<sp/>=<sp/>DMODE_NONE;</highlight></codeline>
<codeline lineno="680"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int24_t<sp/>angle;</highlight></codeline>
<codeline lineno="681"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int24_t<sp/>current;</highlight></codeline>
<codeline lineno="682"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int24_t<sp/>voltage;</highlight></codeline>
<codeline lineno="683"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int24_t<sp/>apparent;</highlight></codeline>
<codeline lineno="684"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int24_t<sp/>real;</highlight></codeline>
<codeline lineno="685"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int24_t<sp/>reactive;</highlight></codeline>
<codeline lineno="686"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>int8_t<sp/>i;</highlight></codeline>
<codeline lineno="687"><highlight class="normal"></highlight></codeline>
<codeline lineno="688"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>PEIE<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="689"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GIE<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="690"><highlight class="normal"></highlight></codeline>
<codeline lineno="691"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1a4c3b7689564254274a0e3a2a1771d473" kindref="member">initPins</ref>();</highlight></codeline>
<codeline lineno="692"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1a0103fec987197d5a370a762edbe779e7" kindref="member">initFVR</ref>();</highlight></codeline>
<codeline lineno="693"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1ab3166bd1ba3160d3bac85daddb12f947" kindref="member">initADC</ref>();</highlight></codeline>
<codeline lineno="694"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1ac54dcca941c1bea6b7bc3d8babb5aaaf" kindref="member">initTMR1</ref>();</highlight></codeline>
<codeline lineno="695"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1a990271cb1bf71a9ad908cf95daf1eb6b" kindref="member">initPWMTMR4</ref>();</highlight></codeline>
<codeline lineno="696"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1ae0b5b4551a6c8f5e5cd0bc1f8f07a8c6" kindref="member">initCOMP1</ref>();</highlight></codeline>
<codeline lineno="697"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1acc739909b6a4e417b9af88738e662987" kindref="member">initCOMP2</ref>();</highlight></codeline>
<codeline lineno="698"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1a1937a1a69f27dd9e91c099e4429731be" kindref="member">initBT</ref>();</highlight></codeline>
<codeline lineno="699"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="message_8h_1a01e4010741e5ee38acf158276ed9a3af" kindref="member">initMessaging</ref>();</highlight></codeline>
<codeline lineno="700"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>PEIE<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="701"><highlight class="normal"></highlight></codeline>
<codeline lineno="702"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1a8f35dad172390f2c99bf58f71c4fe2fb" kindref="member">clearDisplay</ref>(SHIFT_REG_LEN);</highlight></codeline>
<codeline lineno="703"><highlight class="normal"></highlight></codeline>
<codeline lineno="704"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">while</highlight><highlight class="normal"><sp/>(1)<sp/>{</highlight></codeline>
<codeline lineno="705"><highlight class="normal"></highlight></codeline>
<codeline lineno="706"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GIE<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="707"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>__delay_ms(50);</highlight></codeline>
<codeline lineno="708"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>GIE<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="709"><highlight class="normal"></highlight></codeline>
<codeline lineno="710"><highlight class="normal"></highlight></codeline>
<codeline lineno="711"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//calculate<sp/>the<sp/>values<sp/>and<sp/>send<sp/>only<sp/>of<sp/>both<sp/>phases<sp/>have<sp/>been<sp/>recorded</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="712"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>((flag<sp/>&amp;<sp/>0x02)<sp/>&amp;&amp;<sp/>(flag<sp/>&amp;<sp/>0x01))<sp/>{<sp/></highlight><highlight class="comment">//volts<sp/>and<sp/>current</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="713"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(flag<sp/>&amp;<sp/>0x04)<sp/></highlight><highlight class="comment">//volts<sp/>first</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="714"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>angle<sp/>=<sp/>(<ref refid="powerspy_8h_1aa7e5cea063dbb34802dda31333eaef58" kindref="member">deltaT</ref>(volt_time,<sp/>curr_time)<sp/>&gt;&gt;<sp/>2);<sp/></highlight><highlight class="comment">//<sp/>(*250/1000)<sp/>==<sp/>(/4)<sp/>==<sp/>(&gt;&gt;2)</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="715"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(flag<sp/>&amp;<sp/>0x08)<sp/></highlight><highlight class="comment">//current<sp/>first</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="716"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>angle<sp/>=<sp/>(<ref refid="powerspy_8h_1aa7e5cea063dbb34802dda31333eaef58" kindref="member">deltaT</ref>(curr_time,<sp/>volt_time)<sp/>&gt;&gt;<sp/>2);</highlight></codeline>
<codeline lineno="717"><highlight class="normal"></highlight></codeline>
<codeline lineno="718"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>flag<sp/>&amp;=<sp/>0xf0;</highlight></codeline>
<codeline lineno="719"><highlight class="normal"></highlight></codeline>
<codeline lineno="720"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//angle<sp/>now<sp/>in<sp/>us</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="721"><highlight class="normal"></highlight></codeline>
<codeline lineno="722"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="comment">//d<sp/>=<sp/>-5/2<sp/>vdd</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="723"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i_u_offs<sp/>=<sp/><ref refid="powerspy_8h_1aac2b18361514a260b77f367bb12fa77a" kindref="member">readVdd</ref>()<sp/>*<sp/>5;</highlight></codeline>
<codeline lineno="724"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i_u_offs<sp/>&gt;&gt;=<sp/>1;</highlight></codeline>
<codeline lineno="725"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>i_u_offs<sp/>=<sp/>-i_u_offs;</highlight></codeline>
<codeline lineno="726"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="727"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="message_8h_1a0c25a5fe76d1638f8da153040e752c00" kindref="member">sendUInt8</ref>(K_RAWVOLTAGE);</highlight></codeline>
<codeline lineno="728"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="message_8h_1a5451b692d0059527514ddbbab9ced49f" kindref="member">sendInt24</ref>(ADRES);</highlight></codeline>
<codeline lineno="729"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight></codeline>
<codeline lineno="730"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>current<sp/>=<sp/><ref refid="powerspy_8h_1a69737966a3174628c469a37d6db002a7" kindref="member">readCurrent</ref>();</highlight></codeline>
<codeline lineno="731"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>voltage<sp/>=<sp/><ref refid="powerspy_8h_1abad6c151b93f88becacb00a6f3727416" kindref="member">readVoltage</ref>();</highlight></codeline>
<codeline lineno="732"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>apparent<sp/>=<sp/>voltage<sp/>*<sp/>current;</highlight></codeline>
<codeline lineno="733"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>real<sp/>=<sp/>(apparent<sp/>*<sp/><ref refid="powerspy_8h_1ab00c5a1c9dde13d399d08c6a19f89bcc" kindref="member">cos</ref>(angle))<sp/>/<sp/>MAX_SIN_RES;</highlight></codeline>
<codeline lineno="734"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>reactive<sp/>=<sp/>(apparent<sp/>*<sp/><ref refid="powerspy_8h_1ad09cda1044ebc5675a9b462e5a11978a" kindref="member">sin</ref>(angle))<sp/>/<sp/>MAX_SIN_RES;</highlight></codeline>
<codeline lineno="735"><highlight class="normal"></highlight></codeline>
<codeline lineno="736"><highlight class="normal"></highlight></codeline>
<codeline lineno="737"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="message_8h_1a0c25a5fe76d1638f8da153040e752c00" kindref="member">sendUInt8</ref>(K_RAWCURRENT);</highlight></codeline>
<codeline lineno="738"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="message_8h_1a5451b692d0059527514ddbbab9ced49f" kindref="member">sendInt24</ref>(ADRES);</highlight></codeline>
<codeline lineno="739"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="message_8h_1a0c25a5fe76d1638f8da153040e752c00" kindref="member">sendUInt8</ref>(K_OFFS);</highlight></codeline>
<codeline lineno="740"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="message_8h_1a5451b692d0059527514ddbbab9ced49f" kindref="member">sendInt24</ref>(i_u_offs);</highlight></codeline>
<codeline lineno="741"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="message_8h_1a0c25a5fe76d1638f8da153040e752c00" kindref="member">sendUInt8</ref>(K_CURRENT);</highlight></codeline>
<codeline lineno="742"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="message_8h_1a5451b692d0059527514ddbbab9ced49f" kindref="member">sendInt24</ref>(current);</highlight></codeline>
<codeline lineno="743"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="message_8h_1a0c25a5fe76d1638f8da153040e752c00" kindref="member">sendUInt8</ref>(K_APPARENTEPOWER);</highlight></codeline>
<codeline lineno="744"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="message_8h_1a5451b692d0059527514ddbbab9ced49f" kindref="member">sendInt24</ref>(apparent);</highlight></codeline>
<codeline lineno="745"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="message_8h_1a0c25a5fe76d1638f8da153040e752c00" kindref="member">sendUInt8</ref>(K_REALPOWER);</highlight></codeline>
<codeline lineno="746"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="message_8h_1a5451b692d0059527514ddbbab9ced49f" kindref="member">sendInt24</ref>(real);</highlight></codeline>
<codeline lineno="747"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="message_8h_1a0c25a5fe76d1638f8da153040e752c00" kindref="member">sendUInt8</ref>(K_REACTIVEPOWER);</highlight></codeline>
<codeline lineno="748"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="message_8h_1a5451b692d0059527514ddbbab9ced49f" kindref="member">sendInt24</ref>(reactive);</highlight></codeline>
<codeline lineno="749"><highlight class="normal"></highlight></codeline>
<codeline lineno="750"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DISPLAY_LAT<sp/>=<sp/>0;</highlight></codeline>
<codeline lineno="751"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">switch</highlight><highlight class="normal"><sp/>(bmode)<sp/>{</highlight></codeline>
<codeline lineno="752"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>DMODE_NONE:</highlight></codeline>
<codeline lineno="753"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">default</highlight><highlight class="normal">:</highlight></codeline>
<codeline lineno="754"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1ae516f2ff48d3fcf8c5fd638c92878e66" kindref="member">setUnit</ref>(UNIT_NONE);</highlight></codeline>
<codeline lineno="755"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1ac2e00b08576dfbc9457a38a93daf5cf7" kindref="member">setVal</ref>(0);</highlight></codeline>
<codeline lineno="756"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1aa76a726af97e61c931dc5c48da533842" kindref="member">setLED</ref>(0x00,<sp/>0x00,<sp/>0x00);<sp/></highlight><highlight class="comment">//out</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="757"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="758"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>DMODE_CURRENT:</highlight></codeline>
<codeline lineno="759"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1ae516f2ff48d3fcf8c5fd638c92878e66" kindref="member">setUnit</ref>(UNIT_A);</highlight></codeline>
<codeline lineno="760"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1ac2e00b08576dfbc9457a38a93daf5cf7" kindref="member">setVal</ref>(current<sp/>/<sp/>1000);</highlight></codeline>
<codeline lineno="761"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1aa76a726af97e61c931dc5c48da533842" kindref="member">setLED</ref>(0x00,<sp/>LED_INTENSE,<sp/>0x00);<sp/></highlight><highlight class="comment">//red</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="762"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="763"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>DMODE_REAL:</highlight></codeline>
<codeline lineno="764"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1ae516f2ff48d3fcf8c5fd638c92878e66" kindref="member">setUnit</ref>(UNIT_W);</highlight></codeline>
<codeline lineno="765"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1ac2e00b08576dfbc9457a38a93daf5cf7" kindref="member">setVal</ref>(real<sp/>/<sp/>1000);</highlight></codeline>
<codeline lineno="766"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1aa76a726af97e61c931dc5c48da533842" kindref="member">setLED</ref>(LED_INTENSE,<sp/>0x00,<sp/>0x00);<sp/></highlight><highlight class="comment">//green</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="767"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="768"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>DMODE_APPARENT:</highlight></codeline>
<codeline lineno="769"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1ae516f2ff48d3fcf8c5fd638c92878e66" kindref="member">setUnit</ref>(UNIT_VA);</highlight></codeline>
<codeline lineno="770"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1ac2e00b08576dfbc9457a38a93daf5cf7" kindref="member">setVal</ref>(apparent<sp/>/<sp/>1000);</highlight></codeline>
<codeline lineno="771"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1aa76a726af97e61c931dc5c48da533842" kindref="member">setLED</ref>(0x00,<sp/>0x00,<sp/>LED_INTENSE);<sp/></highlight><highlight class="comment">//blue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="772"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="773"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>DMODE_REACTIVE:</highlight></codeline>
<codeline lineno="774"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1ae516f2ff48d3fcf8c5fd638c92878e66" kindref="member">setUnit</ref>(UNIT_VA);</highlight></codeline>
<codeline lineno="775"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1ac2e00b08576dfbc9457a38a93daf5cf7" kindref="member">setVal</ref>(reactive<sp/>/<sp/>1000);</highlight></codeline>
<codeline lineno="776"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1aa76a726af97e61c931dc5c48da533842" kindref="member">setLED</ref>(LED_INTENSE,<sp/>0x00,<sp/>LED_INTENSE);<sp/></highlight><highlight class="comment">//green<sp/>+<sp/>blue</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="777"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="778"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">case</highlight><highlight class="normal"><sp/>DMODE_VOLTAGE:</highlight></codeline>
<codeline lineno="779"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1ae516f2ff48d3fcf8c5fd638c92878e66" kindref="member">setUnit</ref>(UNIT_V);</highlight></codeline>
<codeline lineno="780"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1ac2e00b08576dfbc9457a38a93daf5cf7" kindref="member">setVal</ref>(voltage);</highlight></codeline>
<codeline lineno="781"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><ref refid="powerspy_8h_1aa76a726af97e61c931dc5c48da533842" kindref="member">setLED</ref>(LED_INTENSE,<sp/>LED_INTENSE,<sp/>0x00);<sp/></highlight><highlight class="comment">//green<sp/>+<sp/>red</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="782"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">break</highlight><highlight class="normal">;</highlight></codeline>
<codeline lineno="783"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="784"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>DISPLAY_LAT<sp/>=<sp/>1;</highlight></codeline>
<codeline lineno="785"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="786"><highlight class="normal"></highlight></codeline>
<codeline lineno="787"><highlight class="normal"></highlight></codeline>
<codeline lineno="788"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/></highlight><highlight class="keywordflow">if</highlight><highlight class="normal"><sp/>(!BUTTON<sp/>&amp;&amp;<sp/>!(flag<sp/>&amp;<sp/>0x10))<sp/>{<sp/></highlight><highlight class="comment">//button<sp/>has<sp/>not<sp/>been<sp/>set</highlight><highlight class="normal"></highlight></codeline>
<codeline lineno="789"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bmode++;</highlight></codeline>
<codeline lineno="790"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>bmode<sp/>%=<sp/>DMODE_MAX;</highlight></codeline>
<codeline lineno="791"><highlight class="normal"></highlight></codeline>
<codeline lineno="792"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>flag<sp/>|=<sp/>0x10;</highlight></codeline>
<codeline lineno="793"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>__delay_ms(10);</highlight></codeline>
<codeline lineno="794"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}<sp/></highlight><highlight class="keywordflow">else</highlight><highlight class="normal"><sp/>{</highlight></codeline>
<codeline lineno="795"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>flag<sp/>&amp;=<sp/>~0x10;</highlight></codeline>
<codeline lineno="796"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="797"><highlight class="normal"><sp/><sp/><sp/><sp/><sp/><sp/><sp/><sp/>}</highlight></codeline>
<codeline lineno="798"><highlight class="normal">}</highlight></codeline>
    </programlisting>
    <location file="powerspy.X/powerspy.c"/>
  </compounddef>
</doxygen>
