<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>PowerSpy: powerspy.X/powerspy.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="PS_Logo_Documentation.png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">PowerSpy
   &#160;<span id="projectnumber">1.0</span>
   </div>
   <div id="projectbrief">PowerSpy is an adapter between Wall-Plugs to measure the power consumption of a device.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_d9f923cd1df04585cd3ba50a456fdb5b.html">powerspy.X</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">powerspy.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><code>#include &lt;xc.h&gt;</code><br />
<code>#include &lt;limits.h&gt;</code><br />
<code>#include &quot;<a class="el" href="types_8h_source.html">types.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="message_8h_source.html">message.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="powerspy_8h_source.html">powerspy.h</a>&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a951d8b2b8bc8596a9ccb6db62ef125d8"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a951d8b2b8bc8596a9ccb6db62ef125d8"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>__EEPROM_DATA</b> (0, 2, 3, 5, 6, 8, 9, 11)</td></tr>
<tr class="separator:a951d8b2b8bc8596a9ccb6db62ef125d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a279116ee624abe7f5a2701de9bbd6a64"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a279116ee624abe7f5a2701de9bbd6a64"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>__EEPROM_DATA</b> (13, 14, 16, 17, 19, 20, 22, 23)</td></tr>
<tr class="separator:a279116ee624abe7f5a2701de9bbd6a64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a345eaed652f9ef24f0cfee26825f3758"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a345eaed652f9ef24f0cfee26825f3758"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>__EEPROM_DATA</b> (25, 26, 28, 29, 31, 32, 34, 35)</td></tr>
<tr class="separator:a345eaed652f9ef24f0cfee26825f3758"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4e517ff0968a4a6f99d0aafa37e402cd"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4e517ff0968a4a6f99d0aafa37e402cd"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>__EEPROM_DATA</b> (37, 38, 40, 41, 43, 44, 45, 47)</td></tr>
<tr class="separator:a4e517ff0968a4a6f99d0aafa37e402cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aba4a6818ab60f0a61940944cc6e0cddd"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aba4a6818ab60f0a61940944cc6e0cddd"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>__EEPROM_DATA</b> (48, 50, 51, 52, 54, 55, 56, 58)</td></tr>
<tr class="separator:aba4a6818ab60f0a61940944cc6e0cddd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae66e7f511735e1a1b5c7fec8e017511e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae66e7f511735e1a1b5c7fec8e017511e"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>__EEPROM_DATA</b> (59, 60, 61, 63, 64, 65, 66, 67)</td></tr>
<tr class="separator:ae66e7f511735e1a1b5c7fec8e017511e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a01df7d06b91e149f05e0fc75bfa57d33"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a01df7d06b91e149f05e0fc75bfa57d33"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>__EEPROM_DATA</b> (68, 70, 71, 72, 73, 74, 75, 76)</td></tr>
<tr class="separator:a01df7d06b91e149f05e0fc75bfa57d33"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a97e03abdbb2ceba6aebeaedb0e932f3b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a97e03abdbb2ceba6aebeaedb0e932f3b"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>__EEPROM_DATA</b> (77, 78, 79, 80, 81, 82, 83, 84)</td></tr>
<tr class="separator:a97e03abdbb2ceba6aebeaedb0e932f3b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a366a1e1813bcfd9903d30070830f56f9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a366a1e1813bcfd9903d30070830f56f9"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>__EEPROM_DATA</b> (84, 85, 86, 87, 88, 88, 89, 90)</td></tr>
<tr class="separator:a366a1e1813bcfd9903d30070830f56f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a878c39524bced3706ad196ed455087a2"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a878c39524bced3706ad196ed455087a2"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>__EEPROM_DATA</b> (90, 91, 92, 92, 93, 94, 94, 95)</td></tr>
<tr class="separator:a878c39524bced3706ad196ed455087a2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0bfcbe82c6b6d3123573240f9c75d4ca"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0bfcbe82c6b6d3123573240f9c75d4ca"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>__EEPROM_DATA</b> (95, 96, 96, 96, 97, 97, 98, 98)</td></tr>
<tr class="separator:a0bfcbe82c6b6d3123573240f9c75d4ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a73e015812d8d8cf671dda37e2619c807"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a73e015812d8d8cf671dda37e2619c807"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>__EEPROM_DATA</b> (98, 99, 99, 99, 99, 99, 100, 100)</td></tr>
<tr class="separator:a73e015812d8d8cf671dda37e2619c807"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c267c2edfcff31a2760dd095809d786"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7c267c2edfcff31a2760dd095809d786"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>__EEPROM_DATA</b> (100, 100, 100, 100, 100, 0, 0, 0)</td></tr>
<tr class="separator:a7c267c2edfcff31a2760dd095809d786"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4c3b7689564254274a0e3a2a1771d473"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#a4c3b7689564254274a0e3a2a1771d473">initPins</a> ()</td></tr>
<tr class="separator:a4c3b7689564254274a0e3a2a1771d473"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab3166bd1ba3160d3bac85daddb12f947"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#ab3166bd1ba3160d3bac85daddb12f947">initADC</a> ()</td></tr>
<tr class="separator:ab3166bd1ba3160d3bac85daddb12f947"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4d4bd39a8d9a35c69d0274fd272bc1d4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#a4d4bd39a8d9a35c69d0274fd272bc1d4">initTMR2</a> ()</td></tr>
<tr class="separator:a4d4bd39a8d9a35c69d0274fd272bc1d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac54dcca941c1bea6b7bc3d8babb5aaaf"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#ac54dcca941c1bea6b7bc3d8babb5aaaf">initTMR1</a> ()</td></tr>
<tr class="separator:ac54dcca941c1bea6b7bc3d8babb5aaaf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0103fec987197d5a370a762edbe779e7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#a0103fec987197d5a370a762edbe779e7">initFVR</a> ()</td></tr>
<tr class="separator:a0103fec987197d5a370a762edbe779e7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a990271cb1bf71a9ad908cf95daf1eb6b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#a990271cb1bf71a9ad908cf95daf1eb6b">initPWMTMR4</a> ()</td></tr>
<tr class="separator:a990271cb1bf71a9ad908cf95daf1eb6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae0b5b4551a6c8f5e5cd0bc1f8f07a8c6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#ae0b5b4551a6c8f5e5cd0bc1f8f07a8c6">initCOMP1</a> ()</td></tr>
<tr class="separator:ae0b5b4551a6c8f5e5cd0bc1f8f07a8c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc739909b6a4e417b9af88738e662987"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#acc739909b6a4e417b9af88738e662987">initCOMP2</a> ()</td></tr>
<tr class="separator:acc739909b6a4e417b9af88738e662987"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1937a1a69f27dd9e91c099e4429731be"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#a1937a1a69f27dd9e91c099e4429731be">initBT</a> ()</td></tr>
<tr class="separator:a1937a1a69f27dd9e91c099e4429731be"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fbdf44d733d619a014a5a6f2315700d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#a4fbdf44d733d619a014a5a6f2315700d">adc</a> (const int8_t src)</td></tr>
<tr class="separator:a4fbdf44d733d619a014a5a6f2315700d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abad6c151b93f88becacb00a6f3727416"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#abad6c151b93f88becacb00a6f3727416">readVoltage</a> ()</td></tr>
<tr class="separator:abad6c151b93f88becacb00a6f3727416"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a69737966a3174628c469a37d6db002a7"><td class="memItemLeft" align="right" valign="top">int24_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#a69737966a3174628c469a37d6db002a7">readCurrent</a> ()</td></tr>
<tr class="separator:a69737966a3174628c469a37d6db002a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aac2b18361514a260b77f367bb12fa77a"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#aac2b18361514a260b77f367bb12fa77a">readVdd</a> ()</td></tr>
<tr class="separator:aac2b18361514a260b77f367bb12fa77a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f26c0064b568a85c7be468e2235a2f4"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#a0f26c0064b568a85c7be468e2235a2f4">so</a> (const uint8_t data)</td></tr>
<tr class="separator:a0f26c0064b568a85c7be468e2235a2f4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8f35dad172390f2c99bf58f71c4fe2fb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#a8f35dad172390f2c99bf58f71c4fe2fb">clearDisplay</a> (int8_t leng)</td></tr>
<tr class="separator:a8f35dad172390f2c99bf58f71c4fe2fb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36e528b890c7edbb7b9eb0c61d725bef"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#a36e528b890c7edbb7b9eb0c61d725bef">sendColour</a> (uint8_t c)</td></tr>
<tr class="separator:a36e528b890c7edbb7b9eb0c61d725bef"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa7e5cea063dbb34802dda31333eaef58"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#aa7e5cea063dbb34802dda31333eaef58">deltaT</a> (uint16_t tm_low, uint16_t tm_high)</td></tr>
<tr class="separator:aa7e5cea063dbb34802dda31333eaef58"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a49011b67fdd3b5aa99c5305c4def8688"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#a49011b67fdd3b5aa99c5305c4def8688">sin_</a> (int8_t z)</td></tr>
<tr class="separator:a49011b67fdd3b5aa99c5305c4def8688"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad09cda1044ebc5675a9b462e5a11978a"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#ad09cda1044ebc5675a9b462e5a11978a">sin</a> (int16_t z)</td></tr>
<tr class="separator:ad09cda1044ebc5675a9b462e5a11978a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77f641354d808eb7adbb519a724d4027"><td class="memItemLeft" align="right" valign="top">int8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#a77f641354d808eb7adbb519a724d4027">cos</a> (int16_t us)</td></tr>
<tr class="separator:a77f641354d808eb7adbb519a724d4027"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6dcfeb080c4fc27b28b9ac99b9a8aa8"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#ab6dcfeb080c4fc27b28b9ac99b9a8aa8">ledReset</a> ()</td></tr>
<tr class="separator:ab6dcfeb080c4fc27b28b9ac99b9a8aa8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa76a726af97e61c931dc5c48da533842"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#aa76a726af97e61c931dc5c48da533842">setLED</a> (uint8_t g, uint8_t r, uint8_t b)</td></tr>
<tr class="separator:aa76a726af97e61c931dc5c48da533842"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae516f2ff48d3fcf8c5fd638c92878e66"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#ae516f2ff48d3fcf8c5fd638c92878e66">setUnit</a> (uint24_t u)</td></tr>
<tr class="separator:ae516f2ff48d3fcf8c5fd638c92878e66"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac2e00b08576dfbc9457a38a93daf5cf7"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#ac2e00b08576dfbc9457a38a93daf5cf7">setVal</a> (int16_t v)</td></tr>
<tr class="separator:ac2e00b08576dfbc9457a38a93daf5cf7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a085e1179e1a03b59da3a42398e8f86f5"><td class="memItemLeft" align="right" valign="top">void __interrupt&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="powerspy_8c.html#a085e1179e1a03b59da3a42398e8f86f5">ISR</a> ()</td></tr>
<tr class="separator:a085e1179e1a03b59da3a42398e8f86f5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acdef7a1fd863a6d3770c1268cb06add3"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="acdef7a1fd863a6d3770c1268cb06add3"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>main</b> ()</td></tr>
<tr class="separator:acdef7a1fd863a6d3770c1268cb06add3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:af2d77e425ddefb2c450823a3d6f84c85"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af2d77e425ddefb2c450823a3d6f84c85"></a>
const uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>get_shift_byte</b> [10] = {NR0, NR1, NR2, NR3, NR4, NR5, NR6, NR7, NR8, NR9}</td></tr>
<tr class="separator:af2d77e425ddefb2c450823a3d6f84c85"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26d6dd4e11d19fb5532884192f76fe6b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a26d6dd4e11d19fb5532884192f76fe6b"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>volt_time</b> = 0</td></tr>
<tr class="separator:a26d6dd4e11d19fb5532884192f76fe6b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a961ddcfe29f60d8ffb4bf2fe46576acd"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a961ddcfe29f60d8ffb4bf2fe46576acd"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>curr_time</b> = 0</td></tr>
<tr class="separator:a961ddcfe29f60d8ffb4bf2fe46576acd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa043779ff6ca752cdff814fbb767aff7"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa043779ff6ca752cdff814fbb767aff7"></a>
volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>flag</b> = 0</td></tr>
<tr class="separator:aa043779ff6ca752cdff814fbb767aff7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76bb5897bb1c4e26f3f09d265e806d46"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a76bb5897bb1c4e26f3f09d265e806d46"></a>
int24_t&#160;</td><td class="memItemRight" valign="bottom"><b>i_u_offs</b> = -12500</td></tr>
<tr class="separator:a76bb5897bb1c4e26f3f09d265e806d46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3086cfffceff5de842407d96e9dfebd0"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3086cfffceff5de842407d96e9dfebd0"></a>
uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>i_u_diode_offs</b> = 7</td></tr>
<tr class="separator:a3086cfffceff5de842407d96e9dfebd0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a89443fdfb1acd74a1fedf4e400757851"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a89443fdfb1acd74a1fedf4e400757851"></a>
uint16_t&#160;</td><td class="memItemRight" valign="bottom"><b>led_rest</b> = 0</td></tr>
<tr class="separator:a89443fdfb1acd74a1fedf4e400757851"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe822df88f0a1fdfd0b8f9641745ad8b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afe822df88f0a1fdfd0b8f9641745ad8b"></a>
volatile uint8_t&#160;</td><td class="memItemRight" valign="bottom"><b>mode</b> = DMODE_NONE</td></tr>
<tr class="separator:afe822df88f0a1fdfd0b8f9641745ad8b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>File: <a class="el" href="powerspy_8c.html">powerspy.c</a> Author: Manuel Federanko</p>
<p>Created on 27 November 2015, 18:58</p>
<p>All information regarding correlation between pins, registers and such has been taken from microchips data sheet for PIC16(L)F1826/27 (DS41391D) </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a4fbdf44d733d619a014a5a6f2315700d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void adc </td>
          <td>(</td>
          <td class="paramtype">const int8_t&#160;</td>
          <td class="paramname"><em>src</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Performs an AD-Conversion on the specified source. The Sources AN0 to AN11 are proportional to the source specified (setting src to 4 will read from AN4). Also the source for the FVR-Buffer1 can be selected, which is 0x1f;</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">src</td><td>the source from which to convert </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a8f35dad172390f2c99bf58f71c4fe2fb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void clearDisplay </td>
          <td>(</td>
          <td class="paramtype">int8_t&#160;</td>
          <td class="paramname"><em>leng</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Clears the display by writing 0xff into every shift register. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">leng</td><td>the number of registers </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="a77f641354d808eb7adbb519a724d4027"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t cos </td>
          <td>(</td>
          <td class="paramtype">int16_t&#160;</td>
          <td class="paramname"><em>z</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Behaves in the exactly same way as <a class="el" href="powerspy_8h.html#ad09cda1044ebc5675a9b462e5a11978a">sin()</a> but returns the cosine. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">z</td><td>the angle ing grad (not deg!) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the cosine multiplied by 100 </dd></dl>

</div>
</div>
<a class="anchor" id="aa7e5cea063dbb34802dda31333eaef58"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t deltaT </td>
          <td>(</td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>tm_low</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>tm_high</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Computes the time difference of the two times. Tm_low is the time, which came chronologically before tm_high. Since these values are the values of Timer 1 at set time it could be, that tm_low&gt;tm_high, if this is the case the difference will be computed as follos: 0xffff - tm_low + tm_high; otherwise the difference is simply tm_high-tm_low. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">tm_low</td><td>the chronologically first value </td></tr>
    <tr><td class="paramname">tm_high</td><td>the chronologically second value </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the time difference in 250nano seconds </dd></dl>

</div>
</div>
<a class="anchor" id="ab3166bd1ba3160d3bac85daddb12f947"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initADC </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Prepare the ADC module for operation. The positive reference is set to Vdd, while the negative one is set to Vss. The conversion clock speed is set to FOSC/64 since the SampleHold - Capacitor would otherwise not be fully charged and unexpected results would be the consequence. </p>

</div>
</div>
<a class="anchor" id="a1937a1a69f27dd9e91c099e4429731be"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initBT </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Configures the USART Module as asynchronous with an baud rate of 9600 and clears all previously received data. </p>

</div>
</div>
<a class="anchor" id="ae0b5b4551a6c8f5e5cd0bc1f8f07a8c6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initCOMP1 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sets up the Comparator 1 Module for measuring the phase of the Voltage. The Interrupt is set to fire on falling edges only. </p>

</div>
</div>
<a class="anchor" id="acc739909b6a4e417b9af88738e662987"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initCOMP2 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sets up the Comparator 2 Module for measuring the phase of the Current. The Interrupt is set to fire on falling edges only. </p>

</div>
</div>
<a class="anchor" id="a0103fec987197d5a370a762edbe779e7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initFVR </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>initializes both Buffers to 1.024Volts. The first one is needed to measure Vdd with the ADC-Module, the second one is used to provide the comparator with a voltage to compare the Voltage against. </p>

</div>
</div>
<a class="anchor" id="a4c3b7689564254274a0e3a2a1771d473"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initPins </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Prepares the ports of the processor. No device may be turned on. They only "exception" to this rule is the Display, which uses shift registers for storing it's information, it is cleared after all other initialisation steps have been finished. This Method also activates the pull up resistor and sets the operation frequency to 32MHz. </p>

</div>
</div>
<a class="anchor" id="a990271cb1bf71a9ad908cf95daf1eb6b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initPWMTMR4 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Prepares the PWM with Timer 4. This PWM is used to provide the second reference to the second comparator, which is used for the current. Since the voltage, representing the current is small, we need to have a precise reference, this we used a PWM with a low-pass filter of second order to create a direct current. The Output is switched from RB3 to RB0. </p>

</div>
</div>
<a class="anchor" id="ac54dcca941c1bea6b7bc3d8babb5aaaf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initTMR1 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Timer 1 is set up with a resolution of 250ns. It is used to measure the phase delay between Current and Voltage. </p>

</div>
</div>
<a class="anchor" id="a4d4bd39a8d9a35c69d0274fd272bc1d4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void initTMR2 </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Prepares the Timer 2 as an refresh-rate generator. This functionality is, as of now, not used and not vital to the operation of the device. </p>

</div>
</div>
<a class="anchor" id="a085e1179e1a03b59da3a42398e8f86f5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void __interrupt ISR </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>The interrupt service routine. It handles incoming data and the phases of current and voltage. </p>

</div>
</div>
<a class="anchor" id="ab6dcfeb080c4fc27b28b9ac99b9a8aa8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t ledReset </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Evaluates if the LED value can be rewritten (the LED needs a reset time of 50us). If these 50us have passed since the last write to the LED this method returns 1 otherwise 0. </p><dl class="section return"><dt>Returns</dt><dd>a flag if the LED can be rewritten </dd></dl>

</div>
</div>
<a class="anchor" id="a69737966a3174628c469a37d6db002a7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int24_t readCurrent </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Measures the current which is currently flowing and returns it in mA as Integer to provide an accurate result, without the implications of using floats. The channel from which the measurement is taken is AN7. </p><dl class="section return"><dt>Returns</dt><dd>the measured current in mAmps. </dd></dl>

</div>
</div>
<a class="anchor" id="aac2b18361514a260b77f367bb12fa77a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t readVdd </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Measures Vdd and returns it as an Integer in the range of 0 to 1023. This is useful, because the calculation of the current is a lot easier if first the conversion from all 10 bit values to more reasonable ones is done and only then the currect value computed. </p><dl class="section return"><dt>Returns</dt><dd>the supply voltage from 0 to 1023 where 0 = 0V and 1023 = 5V </dd></dl>

</div>
</div>
<a class="anchor" id="abad6c151b93f88becacb00a6f3727416"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t readVoltage </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This method is a placeholder method and was written, in case a Voltage measurement was to be implemented. In it's current state it returns the value of 230Volts. </p><dl class="section return"><dt>Returns</dt><dd>the line voltage (about 230V in Europe) </dd></dl>

</div>
</div>
<a class="anchor" id="a36e528b890c7edbb7b9eb0c61d725bef"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void sendColour </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Sends one byte of colour information to the status led. Since the colour depends on the write order this function does not specify the colour of the LED. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">the</td><td>intensity of the colour </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="aa76a726af97e61c931dc5c48da533842"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setLED </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>g</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>r</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>b</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Writes a colour to the LED. The led is programmed with an rgb profile. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">g</td><td>the green colour intensity </td></tr>
    <tr><td class="paramname">r</td><td>the red colour intensity </td></tr>
    <tr><td class="paramname">b</td><td>the blue colour intensity </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ae516f2ff48d3fcf8c5fd638c92878e66"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setUnit </td>
          <td>(</td>
          <td class="paramtype">uint24_t&#160;</td>
          <td class="paramname"><em>u</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Writes a specified unit into the shift registers. Note, that all following registers need to be filled, in order for these values to appear in the correct register. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">u</td><td>the unit to write into the registers </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ac2e00b08576dfbc9457a38a93daf5cf7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void setVal </td>
          <td>(</td>
          <td class="paramtype">int16_t&#160;</td>
          <td class="paramname"><em>v</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Writes the Integer value into the registers. Typically <a class="el" href="powerspy_8h.html#ae516f2ff48d3fcf8c5fd638c92878e66">setUnit()</a> is called prior to this function and only after this function has been called the display will output reasonable values. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">v</td><td></td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a class="anchor" id="ad09cda1044ebc5675a9b462e5a11978a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t sin </td>
          <td>(</td>
          <td class="paramtype">int16_t&#160;</td>
          <td class="paramname"><em>z</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Computes values of the sine, which are not covered by <a class="el" href="powerspy_8h.html#a49011b67fdd3b5aa99c5305c4def8688">sin_()</a>. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">z</td><td>the angle in grad (not deg!) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the sine multiplied by 100 </dd></dl>

</div>
</div>
<a class="anchor" id="a49011b67fdd3b5aa99c5305c4def8688"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int8_t sin_ </td>
          <td>(</td>
          <td class="paramtype">int8_t&#160;</td>
          <td class="paramname"><em>z</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Reads the sine from the eeprom. It is important to note, that not 360° represent a full rotation, but rather 400°. Since not every value can be stored in the eeprom (it is also not needed) it reads only the value from 0 to 100°. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">z</td><td>the angle in grad (not deg!) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>the sine multiplied by 100 </dd></dl>

</div>
</div>
<a class="anchor" id="a0f26c0064b568a85c7be468e2235a2f4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void so </td>
          <td>(</td>
          <td class="paramtype">const uint8_t&#160;</td>
          <td class="paramname"><em>data</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Shifts one byte of data into the shift registers with the least significant bit first. </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">data</td><td>the data to write into the shift register </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
