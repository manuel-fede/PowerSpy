\hypertarget{powerspy_8c}{}\section{powerspy.\+X/powerspy.c File Reference}
\label{powerspy_8c}\index{powerspy.\+X/powerspy.\+c@{powerspy.\+X/powerspy.\+c}}
{\ttfamily \#include $<$xc.\+h$>$}\\*
{\ttfamily \#include $<$limits.\+h$>$}\\*
{\ttfamily \#include \char`\"{}types.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}message.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}powerspy.\+h\char`\"{}}\\*
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
{\bfseries \+\_\+\+\_\+\+E\+E\+P\+R\+O\+M\+\_\+\+D\+A\+TA} (0, 2, 3, 5, 6, 8, 9, 11)\hypertarget{powerspy_8c_a951d8b2b8bc8596a9ccb6db62ef125d8}{}\label{powerspy_8c_a951d8b2b8bc8596a9ccb6db62ef125d8}

\item 
{\bfseries \+\_\+\+\_\+\+E\+E\+P\+R\+O\+M\+\_\+\+D\+A\+TA} (13, 14, 16, 17, 19, 20, 22, 23)\hypertarget{powerspy_8c_a279116ee624abe7f5a2701de9bbd6a64}{}\label{powerspy_8c_a279116ee624abe7f5a2701de9bbd6a64}

\item 
{\bfseries \+\_\+\+\_\+\+E\+E\+P\+R\+O\+M\+\_\+\+D\+A\+TA} (25, 26, 28, 29, 31, 32, 34, 35)\hypertarget{powerspy_8c_a345eaed652f9ef24f0cfee26825f3758}{}\label{powerspy_8c_a345eaed652f9ef24f0cfee26825f3758}

\item 
{\bfseries \+\_\+\+\_\+\+E\+E\+P\+R\+O\+M\+\_\+\+D\+A\+TA} (37, 38, 40, 41, 43, 44, 45, 47)\hypertarget{powerspy_8c_a4e517ff0968a4a6f99d0aafa37e402cd}{}\label{powerspy_8c_a4e517ff0968a4a6f99d0aafa37e402cd}

\item 
{\bfseries \+\_\+\+\_\+\+E\+E\+P\+R\+O\+M\+\_\+\+D\+A\+TA} (48, 50, 51, 52, 54, 55, 56, 58)\hypertarget{powerspy_8c_aba4a6818ab60f0a61940944cc6e0cddd}{}\label{powerspy_8c_aba4a6818ab60f0a61940944cc6e0cddd}

\item 
{\bfseries \+\_\+\+\_\+\+E\+E\+P\+R\+O\+M\+\_\+\+D\+A\+TA} (59, 60, 61, 63, 64, 65, 66, 67)\hypertarget{powerspy_8c_ae66e7f511735e1a1b5c7fec8e017511e}{}\label{powerspy_8c_ae66e7f511735e1a1b5c7fec8e017511e}

\item 
{\bfseries \+\_\+\+\_\+\+E\+E\+P\+R\+O\+M\+\_\+\+D\+A\+TA} (68, 70, 71, 72, 73, 74, 75, 76)\hypertarget{powerspy_8c_a01df7d06b91e149f05e0fc75bfa57d33}{}\label{powerspy_8c_a01df7d06b91e149f05e0fc75bfa57d33}

\item 
{\bfseries \+\_\+\+\_\+\+E\+E\+P\+R\+O\+M\+\_\+\+D\+A\+TA} (77, 78, 79, 80, 81, 82, 83, 84)\hypertarget{powerspy_8c_a97e03abdbb2ceba6aebeaedb0e932f3b}{}\label{powerspy_8c_a97e03abdbb2ceba6aebeaedb0e932f3b}

\item 
{\bfseries \+\_\+\+\_\+\+E\+E\+P\+R\+O\+M\+\_\+\+D\+A\+TA} (84, 85, 86, 87, 88, 88, 89, 90)\hypertarget{powerspy_8c_a366a1e1813bcfd9903d30070830f56f9}{}\label{powerspy_8c_a366a1e1813bcfd9903d30070830f56f9}

\item 
{\bfseries \+\_\+\+\_\+\+E\+E\+P\+R\+O\+M\+\_\+\+D\+A\+TA} (90, 91, 92, 92, 93, 94, 94, 95)\hypertarget{powerspy_8c_a878c39524bced3706ad196ed455087a2}{}\label{powerspy_8c_a878c39524bced3706ad196ed455087a2}

\item 
{\bfseries \+\_\+\+\_\+\+E\+E\+P\+R\+O\+M\+\_\+\+D\+A\+TA} (95, 96, 96, 96, 97, 97, 98, 98)\hypertarget{powerspy_8c_a0bfcbe82c6b6d3123573240f9c75d4ca}{}\label{powerspy_8c_a0bfcbe82c6b6d3123573240f9c75d4ca}

\item 
{\bfseries \+\_\+\+\_\+\+E\+E\+P\+R\+O\+M\+\_\+\+D\+A\+TA} (98, 99, 99, 99, 99, 99, 100, 100)\hypertarget{powerspy_8c_a73e015812d8d8cf671dda37e2619c807}{}\label{powerspy_8c_a73e015812d8d8cf671dda37e2619c807}

\item 
{\bfseries \+\_\+\+\_\+\+E\+E\+P\+R\+O\+M\+\_\+\+D\+A\+TA} (100, 100, 100, 100, 100, 0, 0, 0)\hypertarget{powerspy_8c_a7c267c2edfcff31a2760dd095809d786}{}\label{powerspy_8c_a7c267c2edfcff31a2760dd095809d786}

\item 
void \hyperlink{powerspy_8c_a4c3b7689564254274a0e3a2a1771d473}{init\+Pins} ()
\item 
void \hyperlink{powerspy_8c_ab3166bd1ba3160d3bac85daddb12f947}{init\+A\+DC} ()
\item 
void \hyperlink{powerspy_8c_a4d4bd39a8d9a35c69d0274fd272bc1d4}{init\+T\+M\+R2} ()
\item 
void \hyperlink{powerspy_8c_ac54dcca941c1bea6b7bc3d8babb5aaaf}{init\+T\+M\+R1} ()
\item 
void \hyperlink{powerspy_8c_a0103fec987197d5a370a762edbe779e7}{init\+F\+VR} ()
\item 
void \hyperlink{powerspy_8c_a990271cb1bf71a9ad908cf95daf1eb6b}{init\+P\+W\+M\+T\+M\+R4} ()
\item 
void \hyperlink{powerspy_8c_ae0b5b4551a6c8f5e5cd0bc1f8f07a8c6}{init\+C\+O\+M\+P1} ()
\item 
void \hyperlink{powerspy_8c_acc739909b6a4e417b9af88738e662987}{init\+C\+O\+M\+P2} ()
\item 
void \hyperlink{powerspy_8c_a1937a1a69f27dd9e91c099e4429731be}{init\+BT} ()
\item 
void \hyperlink{powerspy_8c_a4fbdf44d733d619a014a5a6f2315700d}{adc} (const int8\+\_\+t src)
\item 
uint8\+\_\+t \hyperlink{powerspy_8c_abad6c151b93f88becacb00a6f3727416}{read\+Voltage} ()
\item 
int24\+\_\+t \hyperlink{powerspy_8c_a69737966a3174628c469a37d6db002a7}{read\+Current} ()
\item 
uint16\+\_\+t \hyperlink{powerspy_8c_aac2b18361514a260b77f367bb12fa77a}{read\+Vdd} ()
\item 
void \hyperlink{powerspy_8c_a0f26c0064b568a85c7be468e2235a2f4}{so} (const uint8\+\_\+t data)
\item 
void \hyperlink{powerspy_8c_a8f35dad172390f2c99bf58f71c4fe2fb}{clear\+Display} (int8\+\_\+t leng)
\item 
void \hyperlink{powerspy_8c_a36e528b890c7edbb7b9eb0c61d725bef}{send\+Colour} (uint8\+\_\+t c)
\item 
uint16\+\_\+t \hyperlink{powerspy_8c_aa7e5cea063dbb34802dda31333eaef58}{deltaT} (uint16\+\_\+t tm\+\_\+low, uint16\+\_\+t tm\+\_\+high)
\item 
int8\+\_\+t \hyperlink{powerspy_8c_a49011b67fdd3b5aa99c5305c4def8688}{sin\+\_\+} (int8\+\_\+t z)
\item 
int8\+\_\+t \hyperlink{powerspy_8c_ad09cda1044ebc5675a9b462e5a11978a}{sin} (int16\+\_\+t z)
\item 
int8\+\_\+t \hyperlink{powerspy_8c_a77f641354d808eb7adbb519a724d4027}{cos} (int16\+\_\+t us)
\item 
uint8\+\_\+t \hyperlink{powerspy_8c_ab6dcfeb080c4fc27b28b9ac99b9a8aa8}{led\+Reset} ()
\item 
void \hyperlink{powerspy_8c_aa76a726af97e61c931dc5c48da533842}{set\+L\+ED} (uint8\+\_\+t g, uint8\+\_\+t r, uint8\+\_\+t b)
\item 
void \hyperlink{powerspy_8c_ae516f2ff48d3fcf8c5fd638c92878e66}{set\+Unit} (uint24\+\_\+t u)
\item 
void \hyperlink{powerspy_8c_ac2e00b08576dfbc9457a38a93daf5cf7}{set\+Val} (int16\+\_\+t v)
\item 
void \+\_\+\+\_\+interrupt \hyperlink{powerspy_8c_a085e1179e1a03b59da3a42398e8f86f5}{I\+SR} ()
\item 
void {\bfseries main} ()\hypertarget{powerspy_8c_acdef7a1fd863a6d3770c1268cb06add3}{}\label{powerspy_8c_acdef7a1fd863a6d3770c1268cb06add3}

\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
const uint8\+\_\+t {\bfseries get\+\_\+shift\+\_\+byte} \mbox{[}10\mbox{]} = \{N\+R0, N\+R1, N\+R2, N\+R3, N\+R4, N\+R5, N\+R6, N\+R7, N\+R8, N\+R9\}\hypertarget{powerspy_8c_af2d77e425ddefb2c450823a3d6f84c85}{}\label{powerspy_8c_af2d77e425ddefb2c450823a3d6f84c85}

\item 
uint16\+\_\+t {\bfseries volt\+\_\+time} = 0\hypertarget{powerspy_8c_a26d6dd4e11d19fb5532884192f76fe6b}{}\label{powerspy_8c_a26d6dd4e11d19fb5532884192f76fe6b}

\item 
uint16\+\_\+t {\bfseries curr\+\_\+time} = 0\hypertarget{powerspy_8c_a961ddcfe29f60d8ffb4bf2fe46576acd}{}\label{powerspy_8c_a961ddcfe29f60d8ffb4bf2fe46576acd}

\item 
volatile uint8\+\_\+t {\bfseries flag} = 0\hypertarget{powerspy_8c_aa043779ff6ca752cdff814fbb767aff7}{}\label{powerspy_8c_aa043779ff6ca752cdff814fbb767aff7}

\item 
int24\+\_\+t {\bfseries i\+\_\+u\+\_\+offs} = -\/12500\hypertarget{powerspy_8c_a76bb5897bb1c4e26f3f09d265e806d46}{}\label{powerspy_8c_a76bb5897bb1c4e26f3f09d265e806d46}

\item 
uint8\+\_\+t {\bfseries i\+\_\+u\+\_\+diode\+\_\+offs} = 7\hypertarget{powerspy_8c_a3086cfffceff5de842407d96e9dfebd0}{}\label{powerspy_8c_a3086cfffceff5de842407d96e9dfebd0}

\item 
uint16\+\_\+t {\bfseries led\+\_\+rest} = 0\hypertarget{powerspy_8c_a89443fdfb1acd74a1fedf4e400757851}{}\label{powerspy_8c_a89443fdfb1acd74a1fedf4e400757851}

\item 
volatile uint8\+\_\+t {\bfseries mode} = D\+M\+O\+D\+E\+\_\+\+N\+O\+NE\hypertarget{powerspy_8c_afe822df88f0a1fdfd0b8f9641745ad8b}{}\label{powerspy_8c_afe822df88f0a1fdfd0b8f9641745ad8b}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
File\+: \hyperlink{powerspy_8c}{powerspy.\+c} Author\+: Manuel Federanko

Created on 27 November 2015, 18\+:58

All information regarding correlation between pins, registers and such has been taken from microchips data sheet for P\+I\+C16(\+L)F1826/27 (D\+S41391D) 

\subsection{Function Documentation}
\index{powerspy.\+c@{powerspy.\+c}!adc@{adc}}
\index{adc@{adc}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{adc(const int8\+\_\+t src)}{adc(const int8_t src)}}]{\setlength{\rightskip}{0pt plus 5cm}void adc (
\begin{DoxyParamCaption}
\item[{const int8\+\_\+t}]{src}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_a4fbdf44d733d619a014a5a6f2315700d}{}\label{powerspy_8c_a4fbdf44d733d619a014a5a6f2315700d}
Performs an A\+D-\/\+Conversion on the specified source. The Sources A\+N0 to A\+N11 are proportional to the source specified (setting src to 4 will read from A\+N4). Also the source for the F\+V\+R-\/\+Buffer1 can be selected, which is 0x1f;


\begin{DoxyParams}{Parameters}
{\em src} & the source from which to convert \\
\hline
\end{DoxyParams}
\index{powerspy.\+c@{powerspy.\+c}!clear\+Display@{clear\+Display}}
\index{clear\+Display@{clear\+Display}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{clear\+Display(int8\+\_\+t leng)}{clearDisplay(int8_t leng)}}]{\setlength{\rightskip}{0pt plus 5cm}void clear\+Display (
\begin{DoxyParamCaption}
\item[{int8\+\_\+t}]{leng}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_a8f35dad172390f2c99bf58f71c4fe2fb}{}\label{powerspy_8c_a8f35dad172390f2c99bf58f71c4fe2fb}
Clears the display by writing 0xff into every shift register. 
\begin{DoxyParams}{Parameters}
{\em leng} & the number of registers \\
\hline
\end{DoxyParams}
\index{powerspy.\+c@{powerspy.\+c}!cos@{cos}}
\index{cos@{cos}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{cos(int16\+\_\+t us)}{cos(int16_t us)}}]{\setlength{\rightskip}{0pt plus 5cm}int8\+\_\+t cos (
\begin{DoxyParamCaption}
\item[{int16\+\_\+t}]{z}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_a77f641354d808eb7adbb519a724d4027}{}\label{powerspy_8c_a77f641354d808eb7adbb519a724d4027}
Behaves in the exactly same way as \hyperlink{powerspy_8h_ad09cda1044ebc5675a9b462e5a11978a}{sin()} but returns the cosine. 
\begin{DoxyParams}{Parameters}
{\em z} & the angle ing grad (not deg!) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the cosine multiplied by 100 
\end{DoxyReturn}
\index{powerspy.\+c@{powerspy.\+c}!deltaT@{deltaT}}
\index{deltaT@{deltaT}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{delta\+T(uint16\+\_\+t tm\+\_\+low, uint16\+\_\+t tm\+\_\+high)}{deltaT(uint16_t tm_low, uint16_t tm_high)}}]{\setlength{\rightskip}{0pt plus 5cm}uint16\+\_\+t deltaT (
\begin{DoxyParamCaption}
\item[{uint16\+\_\+t}]{tm\+\_\+low, }
\item[{uint16\+\_\+t}]{tm\+\_\+high}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_aa7e5cea063dbb34802dda31333eaef58}{}\label{powerspy_8c_aa7e5cea063dbb34802dda31333eaef58}
Computes the time difference of the two times. Tm\+\_\+low is the time, which came chronologically before tm\+\_\+high. Since these values are the values of Timer 1 at set time it could be, that tm\+\_\+low$>$tm\+\_\+high, if this is the case the difference will be computed as follos\+: 0xffff -\/ tm\+\_\+low + tm\+\_\+high; otherwise the difference is simply tm\+\_\+high-\/tm\+\_\+low. 
\begin{DoxyParams}{Parameters}
{\em tm\+\_\+low} & the chronologically first value \\
\hline
{\em tm\+\_\+high} & the chronologically second value \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the time difference in 250nano seconds 
\end{DoxyReturn}
\index{powerspy.\+c@{powerspy.\+c}!init\+A\+DC@{init\+A\+DC}}
\index{init\+A\+DC@{init\+A\+DC}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{init\+A\+D\+C()}{initADC()}}]{\setlength{\rightskip}{0pt plus 5cm}void init\+A\+DC (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_ab3166bd1ba3160d3bac85daddb12f947}{}\label{powerspy_8c_ab3166bd1ba3160d3bac85daddb12f947}
Prepare the A\+DC module for operation. The positive reference is set to Vdd, while the negative one is set to Vss. The conversion clock speed is set to F\+O\+S\+C/64 since the Sample\+Hold -\/ Capacitor would otherwise not be fully charged and unexpected results would be the consequence. \index{powerspy.\+c@{powerspy.\+c}!init\+BT@{init\+BT}}
\index{init\+BT@{init\+BT}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{init\+B\+T()}{initBT()}}]{\setlength{\rightskip}{0pt plus 5cm}void init\+BT (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_a1937a1a69f27dd9e91c099e4429731be}{}\label{powerspy_8c_a1937a1a69f27dd9e91c099e4429731be}
Configures the U\+S\+A\+RT Module as asynchronous with an baud rate of 9600 and clears all previously received data. \index{powerspy.\+c@{powerspy.\+c}!init\+C\+O\+M\+P1@{init\+C\+O\+M\+P1}}
\index{init\+C\+O\+M\+P1@{init\+C\+O\+M\+P1}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{init\+C\+O\+M\+P1()}{initCOMP1()}}]{\setlength{\rightskip}{0pt plus 5cm}void init\+C\+O\+M\+P1 (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_ae0b5b4551a6c8f5e5cd0bc1f8f07a8c6}{}\label{powerspy_8c_ae0b5b4551a6c8f5e5cd0bc1f8f07a8c6}
Sets up the Comparator 1 Module for measuring the phase of the Voltage. The Interrupt is set to fire on falling edges only. \index{powerspy.\+c@{powerspy.\+c}!init\+C\+O\+M\+P2@{init\+C\+O\+M\+P2}}
\index{init\+C\+O\+M\+P2@{init\+C\+O\+M\+P2}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{init\+C\+O\+M\+P2()}{initCOMP2()}}]{\setlength{\rightskip}{0pt plus 5cm}void init\+C\+O\+M\+P2 (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_acc739909b6a4e417b9af88738e662987}{}\label{powerspy_8c_acc739909b6a4e417b9af88738e662987}
Sets up the Comparator 2 Module for measuring the phase of the Current. The Interrupt is set to fire on falling edges only. \index{powerspy.\+c@{powerspy.\+c}!init\+F\+VR@{init\+F\+VR}}
\index{init\+F\+VR@{init\+F\+VR}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{init\+F\+V\+R()}{initFVR()}}]{\setlength{\rightskip}{0pt plus 5cm}void init\+F\+VR (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_a0103fec987197d5a370a762edbe779e7}{}\label{powerspy_8c_a0103fec987197d5a370a762edbe779e7}
initializes both Buffers to 1.\+024\+Volts. The first one is needed to measure Vdd with the A\+D\+C-\/\+Module, the second one is used to provide the comparator with a voltage to compare the Voltage against. \index{powerspy.\+c@{powerspy.\+c}!init\+Pins@{init\+Pins}}
\index{init\+Pins@{init\+Pins}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{init\+Pins()}{initPins()}}]{\setlength{\rightskip}{0pt plus 5cm}void init\+Pins (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_a4c3b7689564254274a0e3a2a1771d473}{}\label{powerspy_8c_a4c3b7689564254274a0e3a2a1771d473}
Prepares the ports of the processor. No device may be turned on. They only \char`\"{}exception\char`\"{} to this rule is the Display, which uses shift registers for storing it\textquotesingle{}s information, it is cleared after all other initialisation steps have been finished. This Method also activates the pull up resistor and sets the operation frequency to 32\+M\+Hz. \index{powerspy.\+c@{powerspy.\+c}!init\+P\+W\+M\+T\+M\+R4@{init\+P\+W\+M\+T\+M\+R4}}
\index{init\+P\+W\+M\+T\+M\+R4@{init\+P\+W\+M\+T\+M\+R4}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{init\+P\+W\+M\+T\+M\+R4()}{initPWMTMR4()}}]{\setlength{\rightskip}{0pt plus 5cm}void init\+P\+W\+M\+T\+M\+R4 (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_a990271cb1bf71a9ad908cf95daf1eb6b}{}\label{powerspy_8c_a990271cb1bf71a9ad908cf95daf1eb6b}
Prepares the P\+WM with Timer 4. This P\+WM is used to provide the second reference to the second comparator, which is used for the current. Since the voltage, representing the current is small, we need to have a precise reference, this we used a P\+WM with a low-\/pass filter of second order to create a direct current. The Output is switched from R\+B3 to R\+B0. \index{powerspy.\+c@{powerspy.\+c}!init\+T\+M\+R1@{init\+T\+M\+R1}}
\index{init\+T\+M\+R1@{init\+T\+M\+R1}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{init\+T\+M\+R1()}{initTMR1()}}]{\setlength{\rightskip}{0pt plus 5cm}void init\+T\+M\+R1 (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_ac54dcca941c1bea6b7bc3d8babb5aaaf}{}\label{powerspy_8c_ac54dcca941c1bea6b7bc3d8babb5aaaf}
Timer 1 is set up with a resolution of 250ns. It is used to measure the phase delay between Current and Voltage. \index{powerspy.\+c@{powerspy.\+c}!init\+T\+M\+R2@{init\+T\+M\+R2}}
\index{init\+T\+M\+R2@{init\+T\+M\+R2}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{init\+T\+M\+R2()}{initTMR2()}}]{\setlength{\rightskip}{0pt plus 5cm}void init\+T\+M\+R2 (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_a4d4bd39a8d9a35c69d0274fd272bc1d4}{}\label{powerspy_8c_a4d4bd39a8d9a35c69d0274fd272bc1d4}
Prepares the Timer 2 as an refresh-\/rate generator. This functionality is, as of now, not used and not vital to the operation of the device. \index{powerspy.\+c@{powerspy.\+c}!I\+SR@{I\+SR}}
\index{I\+SR@{I\+SR}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{I\+S\+R()}{ISR()}}]{\setlength{\rightskip}{0pt plus 5cm}void \+\_\+\+\_\+interrupt I\+SR (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_a085e1179e1a03b59da3a42398e8f86f5}{}\label{powerspy_8c_a085e1179e1a03b59da3a42398e8f86f5}
The interrupt service routine. It handles incoming data and the phases of current and voltage. \index{powerspy.\+c@{powerspy.\+c}!led\+Reset@{led\+Reset}}
\index{led\+Reset@{led\+Reset}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{led\+Reset()}{ledReset()}}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t led\+Reset (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_ab6dcfeb080c4fc27b28b9ac99b9a8aa8}{}\label{powerspy_8c_ab6dcfeb080c4fc27b28b9ac99b9a8aa8}
Evaluates if the L\+ED value can be rewritten (the L\+ED needs a reset time of 50us). If these 50us have passed since the last write to the L\+ED this method returns 1 otherwise 0. \begin{DoxyReturn}{Returns}
a flag if the L\+ED can be rewritten 
\end{DoxyReturn}
\index{powerspy.\+c@{powerspy.\+c}!read\+Current@{read\+Current}}
\index{read\+Current@{read\+Current}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{read\+Current()}{readCurrent()}}]{\setlength{\rightskip}{0pt plus 5cm}int24\+\_\+t read\+Current (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_a69737966a3174628c469a37d6db002a7}{}\label{powerspy_8c_a69737966a3174628c469a37d6db002a7}
Measures the current which is currently flowing and returns it in mA as Integer to provide an accurate result, without the implications of using floats. The channel from which the measurement is taken is A\+N7. \begin{DoxyReturn}{Returns}
the measured current in m\+Amps. 
\end{DoxyReturn}
\index{powerspy.\+c@{powerspy.\+c}!read\+Vdd@{read\+Vdd}}
\index{read\+Vdd@{read\+Vdd}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{read\+Vdd()}{readVdd()}}]{\setlength{\rightskip}{0pt plus 5cm}uint16\+\_\+t read\+Vdd (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_aac2b18361514a260b77f367bb12fa77a}{}\label{powerspy_8c_aac2b18361514a260b77f367bb12fa77a}
Measures Vdd and returns it as an Integer in the range of 0 to 1023. This is useful, because the calculation of the current is a lot easier if first the conversion from all 10 bit values to more reasonable ones is done and only then the currect value computed. \begin{DoxyReturn}{Returns}
the supply voltage from 0 to 1023 where 0 = 0V and 1023 = 5V 
\end{DoxyReturn}
\index{powerspy.\+c@{powerspy.\+c}!read\+Voltage@{read\+Voltage}}
\index{read\+Voltage@{read\+Voltage}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{read\+Voltage()}{readVoltage()}}]{\setlength{\rightskip}{0pt plus 5cm}uint8\+\_\+t read\+Voltage (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_abad6c151b93f88becacb00a6f3727416}{}\label{powerspy_8c_abad6c151b93f88becacb00a6f3727416}
This method is a placeholder method and was written, in case a Voltage measurement was to be implemented. In it\textquotesingle{}s current state it returns the value of 230\+Volts. \begin{DoxyReturn}{Returns}
the line voltage (about 230V in Europe) 
\end{DoxyReturn}
\index{powerspy.\+c@{powerspy.\+c}!send\+Colour@{send\+Colour}}
\index{send\+Colour@{send\+Colour}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{send\+Colour(uint8\+\_\+t c)}{sendColour(uint8_t c)}}]{\setlength{\rightskip}{0pt plus 5cm}void send\+Colour (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t}]{}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_a36e528b890c7edbb7b9eb0c61d725bef}{}\label{powerspy_8c_a36e528b890c7edbb7b9eb0c61d725bef}
Sends one byte of colour information to the status led. Since the colour depends on the write order this function does not specify the colour of the L\+ED. 
\begin{DoxyParams}{Parameters}
{\em the} & intensity of the colour \\
\hline
\end{DoxyParams}
\index{powerspy.\+c@{powerspy.\+c}!set\+L\+ED@{set\+L\+ED}}
\index{set\+L\+ED@{set\+L\+ED}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{set\+L\+E\+D(uint8\+\_\+t g, uint8\+\_\+t r, uint8\+\_\+t b)}{setLED(uint8_t g, uint8_t r, uint8_t b)}}]{\setlength{\rightskip}{0pt plus 5cm}void set\+L\+ED (
\begin{DoxyParamCaption}
\item[{uint8\+\_\+t}]{g, }
\item[{uint8\+\_\+t}]{r, }
\item[{uint8\+\_\+t}]{b}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_aa76a726af97e61c931dc5c48da533842}{}\label{powerspy_8c_aa76a726af97e61c931dc5c48da533842}
Writes a colour to the L\+ED. The led is programmed with an rgb profile. 
\begin{DoxyParams}{Parameters}
{\em g} & the green colour intensity \\
\hline
{\em r} & the red colour intensity \\
\hline
{\em b} & the blue colour intensity \\
\hline
\end{DoxyParams}
\index{powerspy.\+c@{powerspy.\+c}!set\+Unit@{set\+Unit}}
\index{set\+Unit@{set\+Unit}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{set\+Unit(uint24\+\_\+t u)}{setUnit(uint24_t u)}}]{\setlength{\rightskip}{0pt plus 5cm}void set\+Unit (
\begin{DoxyParamCaption}
\item[{uint24\+\_\+t}]{u}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_ae516f2ff48d3fcf8c5fd638c92878e66}{}\label{powerspy_8c_ae516f2ff48d3fcf8c5fd638c92878e66}
Writes a specified unit into the shift registers. Note, that all following registers need to be filled, in order for these values to appear in the correct register. 
\begin{DoxyParams}{Parameters}
{\em u} & the unit to write into the registers \\
\hline
\end{DoxyParams}
\index{powerspy.\+c@{powerspy.\+c}!set\+Val@{set\+Val}}
\index{set\+Val@{set\+Val}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{set\+Val(int16\+\_\+t v)}{setVal(int16_t v)}}]{\setlength{\rightskip}{0pt plus 5cm}void set\+Val (
\begin{DoxyParamCaption}
\item[{int16\+\_\+t}]{v}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_ac2e00b08576dfbc9457a38a93daf5cf7}{}\label{powerspy_8c_ac2e00b08576dfbc9457a38a93daf5cf7}
Writes the Integer value into the registers. Typically \hyperlink{powerspy_8h_ae516f2ff48d3fcf8c5fd638c92878e66}{set\+Unit()} is called prior to this function and only after this function has been called the display will output reasonable values. 
\begin{DoxyParams}{Parameters}
{\em v} & \\
\hline
\end{DoxyParams}
\index{powerspy.\+c@{powerspy.\+c}!sin@{sin}}
\index{sin@{sin}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{sin(int16\+\_\+t z)}{sin(int16_t z)}}]{\setlength{\rightskip}{0pt plus 5cm}int8\+\_\+t sin (
\begin{DoxyParamCaption}
\item[{int16\+\_\+t}]{z}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_ad09cda1044ebc5675a9b462e5a11978a}{}\label{powerspy_8c_ad09cda1044ebc5675a9b462e5a11978a}
Computes values of the sine, which are not covered by \hyperlink{powerspy_8h_a49011b67fdd3b5aa99c5305c4def8688}{sin\+\_\+()}. 
\begin{DoxyParams}{Parameters}
{\em z} & the angle in grad (not deg!) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the sine multiplied by 100 
\end{DoxyReturn}
\index{powerspy.\+c@{powerspy.\+c}!sin\+\_\+@{sin\+\_\+}}
\index{sin\+\_\+@{sin\+\_\+}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{sin\+\_\+(int8\+\_\+t z)}{sin_(int8_t z)}}]{\setlength{\rightskip}{0pt plus 5cm}int8\+\_\+t sin\+\_\+ (
\begin{DoxyParamCaption}
\item[{int8\+\_\+t}]{z}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_a49011b67fdd3b5aa99c5305c4def8688}{}\label{powerspy_8c_a49011b67fdd3b5aa99c5305c4def8688}
Reads the sine from the eeprom. It is important to note, that not 360° represent a full rotation, but rather 400°. Since not every value can be stored in the eeprom (it is also not needed) it reads only the value from 0 to 100°. 
\begin{DoxyParams}{Parameters}
{\em z} & the angle in grad (not deg!) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
the sine multiplied by 100 
\end{DoxyReturn}
\index{powerspy.\+c@{powerspy.\+c}!so@{so}}
\index{so@{so}!powerspy.\+c@{powerspy.\+c}}
\subsubsection[{\texorpdfstring{so(const uint8\+\_\+t data)}{so(const uint8_t data)}}]{\setlength{\rightskip}{0pt plus 5cm}void so (
\begin{DoxyParamCaption}
\item[{const uint8\+\_\+t}]{data}
\end{DoxyParamCaption}
)}\hypertarget{powerspy_8c_a0f26c0064b568a85c7be468e2235a2f4}{}\label{powerspy_8c_a0f26c0064b568a85c7be468e2235a2f4}
Shifts one byte of data into the shift registers with the least significant bit first. 
\begin{DoxyParams}{Parameters}
{\em data} & the data to write into the shift register \\
\hline
\end{DoxyParams}
